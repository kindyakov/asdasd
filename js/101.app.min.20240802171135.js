"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[101,291],{2048:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(1660),s=n(3282),i=n(4429),r=n(9706),l=n(3711),o=n(6047),c=n(9700),d=n(2346),u=n(9661),h=n(2514);class p extends s.A{constructor(e,t,n){const a={columnDefs:[{headerCheckboxSelection:!0,checkboxSelection:!0,width:50,resizable:!1,sortable:!1},{headerName:"ФИО",field:"fullname",minWidth:300,flex:1,cellRenderer:e=>(0,u.a)(e,{iconId:"profile"})},{headerName:"Телефон",field:"username",minWidth:170,flex:.5,cellRenderer:e=>(0,u.a)(e,{funcFormate:o.n})},{headerName:"Почта",field:"email",minWidth:260,flex:.5,sortable:!1,cellRenderer:e=>(0,u.a)(e)},{headerName:"Ячейки",field:"rooms",minWidth:100,flex:.5,valueFormatter:e=>e.value?(0,d.H)(e.value):"нет"},{headerName:"Платеж в мес.",field:"month_payment",minWidth:100,flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-price"),t.innerHTML=e.value?(0,o.F)(e.value):"нет",t}},{headerName:"До платежа",field:"days_left",minWidth:100,flex:.5,cellRenderer:e=>{const t=document.createElement("p");return t.classList.add("table-p"),t.innerHTML=`\n            <svg class='icon icon-calendar'>\n              <use xlink:href='img/svg/sprite.svg#calendar'></use>\n            </svg>\n            <span>${e.value?`${e.value} ${(0,c.Y)(Math.abs(e.value),["День","Дня","Дней"])}`:"Нет"}</span>`,t}},{headerName:"Действия",field:"actions",width:90,cellRenderer:e=>this.actionCellRenderer(e),resizable:!1,sortable:!1}]};super(e,Object.assign({},a,t),Object.assign({},{selectTypeUser:!1,onChangeTypeUser:()=>{}},n)),this.actionCellRenderer=this.actionCellRenderer.bind(this),this.enableEditing=this.enableEditing.bind(this),this.onChangeTypeUser=this.params.onChangeTypeUser}actionCellRenderer(e){const{user_id:t,user_type:n}=e.data,s=e.eGridCell.closest(".ag-row"),r=document.createElement("button");let o;r.classList.add("button-table-actions"),r.innerHTML="<span></span><span></span><span></span><svg class='icon icon-check'><use xlink:href='img/svg/sprite.svg#check'></use></svg>";const c=(0,l.o)(r,{onOpen:()=>{},attrModal:"modal-client",data:e.data});return c.options.onEdit=e=>{this.validatorRow?.revalidate().then((n=>{if(n){const n=new FormData(o);let a={user_id:t};n.set("username",n.get("username").replace(/[+() -]/g,"")),Array.from(n).forEach((e=>a[e[0]]=e[1])),this.editClient({client:a}).finally((()=>{e.toggleEdit(r),e.isEdit=!1,this.disableEditing(s),this.validatorRow.destroy()}))}}))},c.options.onEnableEdit=()=>{o=document.createElement("form"),this.enableEditing(s).forEach((e=>{const t=e.cloneNode(!0);t.value=e.value,o.appendChild(t),"username"===e.name&&a.default("+7 (999) 999-99-99").mask(e),e.addEventListener("input",(()=>{t.value=e.value,this.validatorRow?.revalidateField(t).then((t=>{t?e.classList.remove("just-validate-error-field"):e.classList.add("just-validate-error-field")}))}))})),this.validatorRow=function(e,t={}){if(!e)return;const n=(0,i.f)(e,t),s=e.querySelector('input[name="username"]');return a.default("+7 (999) 999-99-99").mask(s),n.addField(e.querySelector('input[name="fullname"]'),[{rule:"required",errorMessage:"Введите фио"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(s,[{rule:"required",errorMessage:"Введите телефон"},{validator:e=>{const t=a.default.unmask(e,{mask:"+7 (999) 999-99-99"});return Boolean(Number(t)&&10===t.length)},errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="email"]'),[{rule:"required",errorMessage:"Введите почту"},{rule:"email",errorMessage:"Неверный формат"}]),n}(o)},r}render(e){const{clients:t,cnt_pages:n,page:a}=e;this.setPage(a,n),this.gridApi.setGridOption("rowData",t),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,t.length])}async editClient(e){try{this.loader.enable();const t=await r.F.post("/_edit_client_",e);if(200!==t.status)return;(0,h.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}}const g=p},3711:(e,t,n)=>{n.d(t,{o:()=>i});var a=n(9244);let s={tippyInstance:null,isEdit:!1,buttons:[(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-edit-row-table"),t.innerHTML="\n      <svg class='icon icon-edit'>\n        <use xlink:href='img/svg/sprite.svg#edit'></use>\n      </svg>\n      <span>Редактировать</span>",t},(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-open"),t.innerHTML="\n      <svg class='icon icon-arrow-right-circle' styles=\"fill: none;\">\n        <use xlink:href='img/svg/sprite.svg#arrow-right-circle'></use>\n      </svg>\n      <span>Открыть</span>",t}],onEdit:()=>{},onEnableEdit:()=>{},onOpen:()=>{}};function i(e,t={}){const n=Object.assign({toggleEdit:r,toggleActive:l},s,t),i=(0,a.Ay)(e,{allowHTML:!0,trigger:"click",content:t=>{const a=document.createElement("div");function s(t){t.target.closest(".btn-edit-row-table")&&(r(e),n.isEdit=!0,n.onEnableEdit(n)),n.tippyInstance.hide()}return a.classList.add("tippy","table-tippy-client"),n.buttons.forEach((e=>{const t=e();t.setAttribute("data-json",JSON.stringify(n.data)),t.classList.contains("btn-open")&&t.setAttribute("data-modal",n.attrModal),t.addEventListener("click",s),a.appendChild(t)})),a},maxWidth:180,duration:0,placement:"bottom-start",interactive:!0,appendTo:document.body,onTrigger(e,t){n.tippyInstance=e,n.isEdit&&n.onEdit(n)},onShow(t){if(n.isEdit)return!1;l(e)},onHide(t){l(e)}});function r(e){e.classList.toggle("_edit")}function l(e){e.classList.toggle("_active")}return i.options=n,i}},2346:(e,t,n)=>{function a(e){let t,n;return n=Array.isArray(e)?e:e.split(",").map((e=>e.trim())),t=n.map((e=>`№${e}`)),t.join(", ")}n.d(t,{H:()=>a})},9661:(e,t,n)=>{n.d(t,{a:()=>i});var a=n(2783);const s={funcFormate:e=>e,iconId:null,el:null,inputmode:"text",attributes:[]};function i(e,t={}){const{funcFormate:n,iconId:i,el:r,inputmode:l,attributes:o}=Object.assign({},s,t),c=(0,a.n)("div",["wp-input","wp-input-cell","not-edit"]);let d="";if(r&&(c.classList.add("is-dop-content"),r.classList.add("dop-el-content")),i){const e=`<svg class='icon icon-${i}'><use xlink:href='img/svg/sprite.svg#${i}'></use></svg>`;c.insertAdjacentHTML("afterbegin",e),c.classList.add("is-icon")}return o.length&&(d=o.map((e=>`${e[0]}="${e[1]}"`)).join(" ")),c.insertAdjacentHTML("beforeend",`<input type="text" name="${e.colDef.field}" value="${e.value?n(e.value):""}" class="input-cell cell-input not-edit" autocomplete="off" readonly="true" inputmode="${l}" ${d}>${r?r.outerHTML:""}`),c}},8101:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(9291),s=n(2048),i=n(1014);class r extends a.default{constructor({loader:e}){super({loader:e,tables:[{tableSelector:".table-clients",TableComponent:s.A,options:{paginationPageSize:15}}],page:"list-clients"})}async getData(e={}){return(0,i.Lf)(e)}}const l=r},9291:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var a=n(3943),s=n(1417);const i=class{constructor({loader:e,tables:t=[],page:n}){this.loader=e,this.wrapper=document.querySelector(`[data-content="${n}"]`),this.tables=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:n,options:a={},params:s={}}=e;this.table=new t(n,{...a,wrapper:this.wrapper},s),this.tables.push(this.table)})),this.queryParams={},this.init(n)}onRender(){}init(e){this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.changeQueryParams({page:t},e),e.onValueInputSearch=t=>{let n={};n=""!==t?{search_str:t}:{},this.changeQueryParams(n,e)},e.selects.onChange=(t,n,a)=>{const s=n.getAttribute("data-name");this.changeQueryParams({[s]:a},e)},e.calendar&&(e.calendar.methods.onChange=(t,n,s)=>{if(2===t.length){const[n,i]=s.element.name.split(",");this.changeQueryParams({[n]:(0,a.p)(t[0],"YYYY-MM-DD"),[i]:(0,a.p)(t[1],"YYYY-MM-DD")},e)}})}))}changeQueryParams(e,t=null){this.queryParams=(0,s.$)(this.queryParams,e),t?this.renderTable(t,this.queryParams):this.render(this.queryParams)}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}async render(e={}){try{this.loader.enable();const t=await this.getData(e);this.tables.length&&t&&this.actionsTables((e=>e.render(t))),this.onRender(t)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const n=await this.getData(t);e?.render(n)}catch(e){console.error(e)}finally{this.loader.disable()}}}}}]);