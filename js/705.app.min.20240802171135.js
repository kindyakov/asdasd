"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[705,291,932],{7846:(t,e,n)=>{n.d(e,{A:()=>i});var s=n(9244);const a=class{constructor(t,e={}){if(!t)throw new Error("Slider element is required.");this.defaultOptions={start:[20,80],range:{min:0,max:100}},this.options={...this.defaultOptions,...e},this.sliderElement=t,this.slider=noUiSlider.create(this.sliderElement,this.options),this.onSliderUpdate=()=>{},this.onSliderSlide=()=>{},this.sliderElement.noUiSlider.on("update",this._onSliderUpdate.bind(this)),this.sliderElement.noUiSlider.on("slide",this._onSliderSlide.bind(this))}_onSliderUpdate(t,e){"function"==typeof this.onSliderUpdate&&this.onSliderUpdate(t,e)}_onSliderSlide(t,e){"function"==typeof this.onSliderSlide&&this.onSliderSlide(t,e)}},i=class{constructor(t,e={},n){t&&(this.defaultOptions={duration:0,allowHTML:!0,content:"<div>Пусто</div>",trigger:"click",placement:"bottom-start",interactive:!0,appendTo:document.body},this.defaultFilterValues=n,this.filterParams={...this.defaultFilterValues},this.options=Object.assign({},this.defaultOptions,e),this.onOpen=()=>{},this.onClose=()=>{},this.onInput=()=>{},this.onApply=()=>{},this.onClear=()=>{},this.instanceTippy=(0,s.Ay)(t,{onTrigger:(t,e)=>this.onOpen(t,e),onShow:()=>{},onHide:t=>this.onClose(t),...this.options}),this.button=t,this.inputs=[],this.btnApply=[],this.btnClear=[],this.rangeFilters=[],this.rangeSlider=[],this.isSync=!1,this.init(t))}init(t){if(t.length){for(let e=0;e<t.length;e++)this.inputs.push(...this.instanceTippy[e].popper.querySelectorAll(".input-filter")),this.btnApply.push(this.instanceTippy[e].popper.querySelector(".btn-filter-apply")),this.btnClear.push(this.instanceTippy[e].popper.querySelector(".btn-filter-clear")),this.rangeFilters.push(...this.instanceTippy[e].popper.querySelectorAll(".range-filter"));this.isSync=!0}else this.inputs=[...this.instanceTippy.popper.querySelectorAll(".input-filter")],this.btnApply=[this.instanceTippy.popper.querySelector(".btn-filter-apply")],this.btnClear=[this.instanceTippy.popper.querySelector(".btn-filter-clear")],this.rangeFilters=[...this.instanceTippy.popper.querySelectorAll(".range-filter")];this.attachEvents()}attachEvents(){this.inputs.length&&this.inputs.forEach((t=>{const[e,n]=t.name.split("_");t.addEventListener("input",(()=>this.handleInput(t,[e,n]))),t.addEventListener("keydown",(s=>this.handleArrowKeys(t,s,[e,n])))})),this.rangeFilters.length&&this.rangeFilters.forEach((t=>{const[e,n]=t.getAttribute("data-name").split(","),s=new a(t,{start:[this.defaultFilterValues[e],this.defaultFilterValues[n]],range:{min:this.defaultFilterValues[e],max:this.defaultFilterValues[n]},step:1});s.onSliderSlide=(t,e)=>this.handleSliderSlide(t,e,s),this.rangeSlider.push(s)})),this.btnApply.length&&this.btnApply.forEach((t=>t.addEventListener("click",(()=>this.handleBtnApply())))),this.btnClear.length&&this.btnClear.forEach((t=>t.addEventListener("click",(()=>this.handleBtnClear()))))}handleInput(t,[e,n]){this.validateAndCorrect(t,[e,n]),this.onInput()}handleArrowKeys(t,e,[n,s]){const a=+t.getAttribute("data-step"),i=a>=1?0:1,o=this.defaultFilterValues[`${n}_end`];let r=parseFloat(t.value)||0;"ArrowUp"===e.key&&r<o?(r+=a,t.value=r.toFixed(i),e.preventDefault()):"ArrowDown"===e.key&&r>0&&(r-=a,t.value=r.toFixed(i),e.preventDefault()),this.validateAndCorrect(t,[n,s])}handleBtnApply(){this.isSync?this.forInstance((t=>t.hide())):this.instanceTippy.hide(),this.onApply(this.filterParams)}handleBtnClear(){this.inputs.length&&this.inputs.forEach((t=>{t.value=this.defaultFilterValues[t.name],this.changeParams(t,t.value)})),this.rangeSlider.length&&this.rangeSlider.forEach((t=>{t.slider.set(t.options.start)})),this.onClear(this.filterParams)}handleSliderSlide(t,e,n){const s=parseInt(t[e]),a=n.sliderElement.getAttribute("data-name").split(","),i=n.sliderElement.parentElement.querySelector(`[name="${a[e]}"]`);i.value=s,this.isSync&&this.syncFilters(i),this.changeParams(i,i.value)}updateSliderSlide(t,e=!1){const n=t.closest(".filter__block").querySelector(".range-filter");if(n&&this.rangeSlider.length){const s=this.rangeSlider.filter((t=>t.sliderElement.dataset.name===n.dataset.name)),[a,i]=t.name.split("_"),o="start"===i?0:1;s.length&&s.forEach((s=>{if(s.sliderElement==n&&e)return;const a=s.slider.get();a[o]=t.value,s.slider.set(a)}))}}fractionalNumber(t,e){let n=t.value;return/^\d+(\.\d)?$/.test(n)||(n=parseFloat(n).toFixed(1),t.value=isNaN(n)?"":n),parseFloat(n)>e&&(n=e,t.value=n),n}validateAndCorrect(t,[e,n]){const s=this.defaultFilterValues[`${e}_end`];let a=this.fractionalNumber(t,s);if("start"===n){const n=Array.from(this.inputs).find((t=>t.name===`${e}_end`));n&&parseFloat(a)>parseFloat(n.value)&&(t.value=n.value)}else if("end"===n){const n=Array.from(this.inputs).find((t=>t.name===`${e}_start`));n&&parseFloat(a)<parseFloat(n.value)&&(t.value=n.value)}this.isSync&&this.syncFilters(t),this.changeParams(t,t.value),this.updateSliderSlide(t)}changeParams(t,e){this.filterParams[t.name]=+e}forInstance(t=(()=>{})){for(let e=0;e<this.button.length;e++)t(this.instanceTippy[e])}syncFilters(t){const e=this.inputs.filter((e=>e!==t&&e.name===t.name));e.length&&e.forEach((e=>{e.value=t.value})),this.updateSliderSlide(t,!0)}}},6955:(t,e,n)=>{n.d(e,{A:()=>i});var s=n(7846);class a extends s.A{constructor(t,e={}){super(t,{content:'\n  <div class="filter">\n    <div class="filter__content">\n      <div class="filter__block">\n        <span class="filter__block_name">Площадь:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="area_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="area_end" value="10" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Цена:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="price_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="price_end" value="30000" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="1">\n          </div>\n        </div>\n        <div class="filter__range range-filter" data-name="price_start,price_end"></div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Длина:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="length_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="length_end" value="4" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Ширина:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="width_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="width_end" value="3" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Высота:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="height_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="height_end" value="4" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="filter__footer">\n      <button class="filter__button button btn-filter-apply"><span>Применить</span></button><button\n        class="filter__button button transparent btn-filter-clear"><span>Очистить фильтр</span></button>\n    </div>\n  </div>',...e},{area_start:0,area_end:10,price_start:0,price_end:3e4,length_start:0,length_end:4,width_start:0,width_end:3,height_start:0,height_end:4})}}const i=a},4513:(t,e,n)=>{n.d(e,{A:()=>s});const s=class{constructor(t){this.wrapper=t,this.schemes=t.querySelectorAll(".scheme"),this.numRooms={},this.init()}init(){this.schemes.length&&(this.cells=this.wrapper.querySelectorAll(".warehouse__svg-cell"))}changeActive(t){this.schemes.forEach(((e,n)=>{const s=e.closest(".wrap-scheme");t-1===n?s.classList.add("_active"):s.classList.remove("_active")}))}filterCell(t){this.actionsCell((({cell:e,cellId:n})=>{const s=this.numRooms[n]?.rented;void 0===s||-1!=+t&&+t!=+s?e.removeAttribute("data-rented"):e.setAttribute("data-rented",s)}))}actionsCell(t=(()=>{})){this.cells.forEach((e=>{const n=e.getAttribute("data-cell-num");t({cell:e,cellId:n})}))}render(t){if(!this.schemes.length)return;const{plan_rooms:e}=t;this.setNumRooms(e),this.actionsCell((({cell:t,cellId:e})=>{this.numRooms[e]?t.setAttribute("data-rented",this.numRooms[e].rented):t.removeAttribute("data-rented")}))}setNumRooms(t){this.numRooms={},t.forEach((t=>this.numRooms[t.room_id]=t))}}},6325:(t,e,n)=>{n.d(e,{t:()=>s});class s{_groupedElements;_groupedButtons;_groupedContents;_buttonsActive;_contentsActive;constructor(t){this.options=Object.assign({specialSelector:"._my-tab-special",btnSelector:"._my-tab-btn",contentSelector:"._my-tab-content",classBtnActive:"_tab-btn-active",classContentActive:"_tab-content-active",activeIndexTab:0,isCheck:!0,uniqueName:!1,onChange:()=>{},onInit:()=>{}},t),this._groupedElements=[],this._groupedButtons=[],this._groupedContents=[],this._buttonsActive=new Set,this._contentsActive=new Set,this.clickHandler=this.clickHandler.bind(this),this.onChange=this.options.onChange,this.onInit=this.options.onInit,this.init()}get buttonsActive(){return Array.from(this._buttonsActive)}get contentActive(){return Array.from(this._contentsActive)}check(){return this.tabButtons.forEach((t=>{const e=t.getAttribute("data-tab-btn");if(!e)throw new Error(`Плагин myTabs: нет атрибута [data-tab-btn] или он пустой у кнопки ${t}`);const[n,s]=e.split(",");if(!n)throw new Error(`Плагин myTabs: В атрибуте [data-tab-btn="?,${s}"] не указан "name" у кнопки ${t}`);if(!s)throw new Error(`Плагин myTabs: В атрибуте [data-tab-btn="${n},?"] не указан "id" контента у кнопки ${t}`)})),this.tabContents.forEach((t=>{const e=t.getAttribute("data-tab-content");if(!e)throw new Error(`Плагин myTabs: нет атрибута [data-tab-content] или он пустой у блока ${t}`);const[n,s]=e.split(",");if(!n)throw new Error(`Плагин myTabs: В атрибуте [data-tab-content="?,${s}"] не указан "name" у блока ${t}`);if(!s)throw new Error(`Плагин myTabs: В атрибуте [data-tab-content="${n},?"] не указан "id" кнопки у блока ${t}`)})),!1}init(){this.options.uniqueName?(this.tabButtons=document.querySelectorAll(`${this.options.btnSelector}${this.options.specialSelector}`),this.tabContents=document.querySelectorAll(`${this.options.contentSelector}${this.options.specialSelector}`)):(this.tabButtons=document.querySelectorAll(`${this.options.btnSelector}:not(${this.options.specialSelector})`),this.tabContents=document.querySelectorAll(`${this.options.contentSelector}:not(${this.options.specialSelector})`)),this.tabButtons.length&&this.tabContents.length&&(this.options.isCheck&&this.check()||(this.groupElements(this.tabButtons,this._groupedButtons,"data-tab-btn"),this.groupElements(this.tabContents,this._groupedContents,"data-tab-content"),this._groupedButtons.forEach((t=>{let e=null;t.forEach(((t,n)=>{t.classList.remove(this.options.classBtnActive),""===t.getAttribute("data-tab-active")&&null===e&&(e=n)})),e=null!==e?e:this.options.activeIndexTab;const n=t[e],[s,a]=n.getAttribute("data-tab-btn").split(","),i=document.querySelector(`${this.options.contentSelector}[data-tab-content="${s},${a}"]`);n.classList.add(this.options.classBtnActive),this._buttonsActive.add(n),i.classList.add(this.options.classContentActive),this._contentsActive.add(i)})),this._groupedElements=Array.from(this.tabButtons).reduce(((t,e)=>{const[n]=e.getAttribute("data-tab-btn").split(",");return t[n]||(t[n]={buttons:[],contents:[]}),t[n].buttons.push(e),t}),{}),this.tabContents.forEach((t=>{const[e]=t.getAttribute("data-tab-content").split(",");this._groupedElements[e]&&this._groupedElements[e].contents.push(t)})),this.event(),this.onInit(this)))}clickHandler(t){let[e]=t.currentTarget.getAttribute("data-tab-btn").split(","),n=null;n=document.querySelector(`${this.options.btnSelector}[data-tab-name="${e}"].${this.options.classBtnActive}`),t.currentTarget!==n&&this.switchTabs(t.currentTarget,n)}event(){this.tabButtons.forEach(((t,e)=>{t.removeEventListener("click",this.clickHandler),t.addEventListener("click",this.clickHandler)}))}switchTabs(t,e=document.querySelector(`${this.options.btnSelector}[data-tab-name="${t.getAttribute("data-tab-name")}"].${this.options.classBtnActive}`)){if(!t||!e)return;const[n,s]=t.getAttribute("data-tab-btn").split(","),a=e.getAttribute("data-tab-id"),i=document.querySelector(`${this.options.contentSelector}[data-tab-content="${n},${a}"]`),o=document.querySelector(`${this.options.contentSelector}[data-tab-content="${n},${s}"]`);e.classList.remove(this.options.classBtnActive),t.classList.add(this.options.classBtnActive),i.classList.remove(this.options.classContentActive),o.classList.add(this.options.classContentActive),this._buttonsActive.delete(e),this._buttonsActive.add(t),this._contentsActive.delete(i),this._contentsActive.add(o),this.onChange({nextTabBtn:t,prevTabBtn:e,nextTabContent:o,prevTabContent:i})}groupElements(t,e,n){t.forEach((t=>{const[s,a]=t.getAttribute(n).split(",");let i=e.find((t=>t.length>0&&t[0].getAttribute(n).split(",")[0]===s));i||(i=[],e.push(i)),i.push(t),t.setAttribute("data-tab-name",s),t.setAttribute("data-tab-id",a)}))}}},9291:(t,e,n)=>{n.r(e),n.d(e,{default:()=>i});var s=n(3943),a=n(1417);const i=class{constructor({loader:t,tables:e=[],page:n}){this.loader=t,this.wrapper=document.querySelector(`[data-content="${n}"]`),this.tables=[],e.length&&e.forEach((t=>{const{TableComponent:e,tableSelector:n,options:s={},params:a={}}=t;this.table=new e(n,{...s,wrapper:this.wrapper},a),this.tables.push(this.table)})),this.queryParams={},this.init(n)}onRender(){}init(t){this.events()}events(){this.tables.length&&this.actionsTables((t=>{t.onPageChange=e=>this.changeQueryParams({page:e},t),t.onValueInputSearch=e=>{let n={};n=""!==e?{search_str:e}:{},this.changeQueryParams(n,t)},t.selects.onChange=(e,n,s)=>{const a=n.getAttribute("data-name");this.changeQueryParams({[a]:s},t)},t.calendar&&(t.calendar.methods.onChange=(e,n,a)=>{if(2===e.length){const[n,i]=a.element.name.split(",");this.changeQueryParams({[n]:(0,s.p)(e[0],"YYYY-MM-DD"),[i]:(0,s.p)(e[1],"YYYY-MM-DD")},t)}})}))}changeQueryParams(t,e=null){this.queryParams=(0,a.$)(this.queryParams,t),e?this.renderTable(e,this.queryParams):this.render(this.queryParams)}actionsTables(t=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((e=>{t(e)}))}async render(t={}){try{this.loader.enable();const e=await this.getData(t);this.tables.length&&e&&this.actionsTables((t=>t.render(e))),this.onRender(e)}catch(t){console.error(t)}finally{this.loader.disable()}}async renderTable(t,e={}){try{this.loader.enable();const n=await this.getData(e);t?.render(n)}catch(t){console.error(t)}finally{this.loader.disable()}}}},7705:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var s=n(7234),a=n(9291),i=n(4513),o=n(3282),r=n(6047),l=n(3943),c=n(2783);function d(t){return JSON.stringify(t).replace(/\s+/g,"").replace(/"/g,"&quot;")}class p extends o.A{constructor(t,e,n){const s={columnDefs:[{headerName:"Ячейка",field:"room_id",minWidth:80,flex:.3,cellRenderer:t=>{const e=document.createElement("span");return e.classList.add("table-span-agrid"),e.textContent=t.value?"№"+t.value:"___",e}},{headerName:"Клиент",field:"fullname",minWidth:300,flex:1,cellRenderer:t=>(0,c.n)("p",["table-p"],`\n              <svg class='icon icon-profile'>\n                <use xlink:href='img/svg/sprite.svg#profile'></use>\n              </svg>\n              <span>${t.value?t.value:"___"}</span>`)},{headerName:"Этаж",field:"floor",minWidth:50,flex:.3},{headerName:"Площадь",field:"area",minWidth:80,flex:.4,valueFormatter:t=>t.value?t.value+" м²":"___"},{headerName:"Цена",field:"price",minWidth:90,flex:.4,cellRenderer:t=>{const e=document.createElement("span");return e.classList.add("table-span-price"),e.innerHTML=t.value?(0,r.F)(t.value):"нет",e}},{headerName:"Статус",field:"rented",minWidth:110,flex:.3,cellRenderer:t=>{const e=document.createElement("span");return e.classList.add("table-span-agrid"),e.textContent=function(t){const e={0:"Свободно",.25:"Гостевые",.4:"Не оплачено",.5:"Забронировано",.75:"Выезд",1:"Занято"};return e[t]?e[t]:""}(t.value),e}},{headerName:"Дата след. оплаты",field:"next_payment_date",minWidth:100,flex:.5,valueFormatter:t=>t.value?(0,l.p)(t.value):"___"},{headerName:"Дата выезда",field:"",minWidth:100,flex:.4,valueFormatter:t=>t.value?(0,l.p)(t.value):"___"},{headerName:"",field:"",minWidth:250,flex:1,sortable:!1,resizable:!1,cellRenderer:t=>(0,c.n)("div",["table-buttons"],`${function(t){const e={0:`<button class="table-button button" data-modal="modal-get-guest-access" data-json="${d(t)}"><span>Гостевой доступ</span></button>`,.25:`<button class="table-button button" data-modal="" data-json="${d(t)}"><span>Отменить доступ</span></button>`,.4:`<button class="table-button button" data-modal="" data-json="${d(t)}"><span>Отменить оплату</span></button>`,.5:`<button class="table-button button" data-modal="modal-confirmation-client" data-json="${d(t)}"><span>Подтвердить</span></button>`,.75:`<button class="table-button button" data-modal="modal-confirmation-departure" data-json="${d(t)}"><span>Подтвердить</span></button>`,1:`<button class="table-button button" data-modal="modal-agreement" data-json="${d(t)}"><span>Открыть договор</span></button>`};return e[t.rented]?e[t.rented]:""}(t.data)}\n            ${.75==+t.data.rented?`<button class="table-button button transparent" data-modal="" data-json="${d(t.data)}"><span>Ускорить</span></button>`:`<button class="table-button button transparent" data-modal="modal-confirm-open-room" data-json="${d(t.data)}"><span>Открыть</span></button>`}`)}]};super(t,Object.assign({},s,e),Object.assign({},{},n))}render(t){const{rooms:e,cnt_pages:n,page:s}=t;this.setPage(s,n),this.gridApi.setGridOption("rowData",e),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,e.length])}}const h=p;var u=n(6955),m=n(1014),b=n(6353),f=n(6325),_=n(3932);class v extends a.default{constructor({loader:t}){super({loader:t,tables:[{tableSelector:".table-rooms",TableComponent:h,options:{paginationPageSize:10}}],page:"rooms"}),this.planRooms=[],this.selectRooms=[],this.currentRented=null,this.warehouseScheme=new i.A(this.wrapper),this.selectWarehouseFloors=new b.l({uniqueName:"select-warehouse-floors",parentEl:this.wrapper}),this.filterRooms=new u.A([...this.wrapper.querySelectorAll(".btn-set-filters")]),this.tabs=new f.t({classBtnActive:"_active",classContentActive:"_active",specialSelector:".room-tabs",uniqueName:!0}),this.selectsRoomsContent=this.wrapper.querySelector(".selects-rooms"),this.formFilterRoom=this.wrapper.querySelector(".form-filter-room"),this.timerInput=null,this.inputSearch=this.wrapper.querySelector(".input-table-search"),this.roomsContent=this.wrapper.querySelector(".rooms"),this.event()}event(){this.wrapper.addEventListener("click",(t=>{t.target.closest(".btn-filter-scheme:not(._active)")&&this.handleClickFilterScheme(t),t.target.closest(".warehouse__svg-cell[data-rented]")&&this.handleClickCell(t),t.target.closest(".btn-remove-room")&&this.handleClickRemoveRoom(t)})),this.selectWarehouseFloors.onChange=(t,e,n)=>{this.warehouseScheme.changeActive(+n),this.changeQueryParams({floor:+n})},this.filterRooms.onApply=t=>this.changeQueryParams(t),this.formFilterRoom.addEventListener("submit",this.handleSubmit.bind(this)),this.inputSearch.addEventListener("input",this.handleInputSearch.bind(this)),this.tabs.onChange=({nextTabBtn:t})=>{this.formFilterRoom.classList.remove("_none"),t.classList.contains("tab-confirmation")&&(this.formFilterRoom.classList.add("_none"),this.renderConfirmation())},window.addEventListener("resize",this.resizeScrollableContent.bind(this))}handleSubmit(t){t.preventDefault();const e=new FormData(t.target);this.changeQueryParams({search_str:e.get("search_str")})}handleInputSearch(t){const e=t.target;e.value=e.value.replace(/\D/g,""),clearTimeout(this.timerInput),this.timerInput=setTimeout((()=>{this.changeQueryParams({search_str:e.value})}),500)}handleClickFilterScheme(t){const e=t.target.closest(".btn-filter-scheme"),n=this.wrapper.querySelector(".btn-filter-scheme._active"),s=e.getAttribute("data-rented");e.classList.add("_active"),n?.classList.remove("_active"),this.changeQueryParams({rented:s})}handleClickCell(t){t.preventDefault();const e=t.target.closest(".warehouse__svg-cell"),n=+e.getAttribute("data-cell-num"),[s]=this.planRooms.filter((t=>t.room_id==n));e.classList.contains("_selected")?this.changeSelectRooms("remove",s):this.changeSelectRooms("add",s)}handleClickRemoveRoom(t){const e=+t.target.closest(".btn-remove-room").getAttribute("data-room-id"),[n]=this.planRooms.filter((t=>t.room_id==e));this.changeSelectRooms("remove",n)}changeSelectRooms(t,e){const n=()=>{const t=this.selectRooms.map((t=>(0,_.roomHtml)({...t,remove:!0}))).join(""),e=(0,c.n)("div",["wrap-scroll"],t);this.selectsRoomsContent.innerHTML=e.outerHTML,this.selectsRoomsContent.scrollIntoView({block:"center",behavior:"smooth"}),this.resizeScrollableContent()},s=this.wrapper.querySelector(`[data-cell-num="${e.room_id}"]`),a={add:t=>{this.selectRooms.push(t),s.classList.add("_selected"),n()},remove:t=>{s.classList.remove("_selected"),this.selectRooms=this.selectRooms.filter((e=>+e.room_id!=+t.room_id)),n()}};a[t]?.(e)}resizeScrollableContent(){const t=Array.from(this.selectsRoomsContent.querySelectorAll(".room")).reduce(((t,e)=>Math.max(t,e.offsetHeight)),0);this.selectsRoomsContent.style.height=t+6+"px"}onRender(t){if(this.roomsContent.innerHTML="",t){const{rooms:e=[],plan_rooms:n=[]}=t;this.planRooms=s([...this.planRooms,...n],"room_id"),this.warehouseScheme.render(t),e.length?e.forEach((t=>{this.roomsContent.insertAdjacentHTML("beforeend",(0,_.roomHtml)(t))})):this.roomsContent.innerHTML='<div class="not-room"><span>Нет ячеек для отображения<span></div>'}}async getData(t={}){return(0,m.t8)(t)}async renderConfirmation(){try{this.loader.enable();const[{users:t=[]},{users:e=[]}]=await Promise.all([(0,m.zP)(),(0,m.rW)()]),n=this.wrapper.querySelector(".content-confirmation-departure"),s=this.wrapper.querySelector(".content-confirmation-client");n.innerHTML='<div class="not-data"><span>Нет клиентов для отображения<span></div>',s.innerHTML='<div class="not-data"><span>Нет клиентов для отображения<span></div>',t.length&&(n.innerHTML=t.map((t=>(0,_.rowHtml)(t))).join("")),e.length&&(s.innerHTML=e.map((t=>(0,_.row2Html)(t))).join(""))}catch(t){console.error(t)}finally{this.loader.disable()}}}const g=v},3932:(t,e,n)=>{n.r(e),n.d(e,{roomHtml:()=>o,row2Html:()=>l,rowHtml:()=>r});var s=n(6047),a=n(3943);function i(t){return JSON.stringify(t).replace(/\s+/g,"").replace(/"/g,"&quot;")}function o(t){return`\n  <div class="warehouse__body_room room">\n            <div class="room__top">\n              <span>Ячейка: №${t.room_id?t.room_id:""}</span>\n              ${t.remove?`<button class="room__remove btn-remove-room" data-room-id="${t.room_id}"></button>`:""}\n            </div>\n            <div class="room__content">\n              <div class="room__content_prices">\n                <span class="price">${t.price?(0,s.F)(t.price)+" / мес.":""}</span>\n                <span class="text">${function({rented:t}){const e={0:"Свободно",.25:"Гостевые",.4:"Не оплачено",.5:"Забронировано",.75:"Выезд",1:"Занято"};return e[t]?e[t]:""}(t)}</span>\n              </div>\n              <div class="room__content_sizes">\n                <b>${t.volume?t.volume+" м<sup>3</sup>":""}</b>\n                <span>${t.dimensions?t.dimensions:""} — ${t.floor?t.floor+" этаж":""}</span>\n              </div>\n              ${0==t.rented?"":`\n                <div class="room__content_info">\n                  ${t.fullname?`\n                  <p>\n                    <svg class='icon icon-user'>\n                      <use xlink:href='img/svg/sprite.svg#user'></use>\n                    </svg>\n                    <span>${t.fullname}</span>\n                  </p>`:""}\n                  ${t.username?`\n                  <p>\n                    <svg class='icon icon-phone'>\n                      <use xlink:href='img/svg/sprite.svg#phone'></use>\n                    </svg>\n                    <span>${(0,s.n)(t.username)}</span>\n                    ${.4==t.rented?`<button data-json="${i(t)}" class="button-text blue"><span>Позвонить</span></button>`:""}\n                  </p>`:""}\n                </div>\n              `}  \n            </div>\n            <div class="room__bottom">\n              ${function(t){const e={0:`<button class="room__button button" data-json="${i(t)}" data-modal="modal-add-client"><span>Оформить клиенту</span></button>`,.25:`<button class="room__button button" data-json="${i(t)}" data-modal=""><span>Отменить доступ</span></button>`,.45:"",.4:`<button class="room__button button" data-json="${i(t)}" data-modal=""><span>Отменить оплату</span></button>`,.5:`<button class="room__button button" data-json="${i(t)}" data-modal="modal-confirmation-client"><span>Подтвердить клиента</span></button>`,.75:`<button class="room__button button" data-json="${i(t)}" data-modal="modal-confirmation-departure"><span>Подтвердить выезд</span></button>`,1:""};return e[t.rented]?e[t.rented]:""}(t)}\n              <button class="room__button button transparent" data-json="${i(t)}" data-modal="modal-confirm-open-room"><span>Открыть</span></button>\n              ${.75==+t.rented?`<button class="room__button button transparent" data-json="${i(t)}" data-modal=""><span>Ускорить</span></button>`:""}\n            </div>\n          </div>`}function r(t){return`\n  <div class="warehouse__confirmation_row">\n                <p class="name">${t.fullname?t.fullname:""}</p>\n                <span class="span">Выезд:<b>${t.rentenddate?(0,a.p)(t.rentenddate):""}</b></span>\n                <button class="button table-button" data-modal="modal-confirmation-departure" data-json="${i(t)}"><span>Подтвердить</span></button>\n              </div>`}function l(t){return`\n  <div class="warehouse__confirmation_row">\n                <p class="name">${t.familyname} ${t.firstname} ${t.patronymic}</p>\n                <button class="button table-button" data-modal="modal-confirmation-client" data-json="${i(t)}"><span>Подтвердить</span></button>\n              </div>`}}}]);