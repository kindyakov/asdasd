"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[643,829],{1037:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(8868),a=s(182);const n=class{constructor(t,e={}){const s={minRotation:0,maxRotation:0,color:"#64748b",font:{size:14,weight:500,family:"Manrope"}},n={options:{scales:{x:{ticks:s,border:{width:0},grid:{color:"#f3f3f3",lineWidth:1}},y:{ticks:s,grid:{color:"#f3f3f3",lineWidth:1},border:{width:0}}},plugins:{legend:{display:!1},tooltip:{enabled:!1,external:function(t){const{chart:e,tooltip:s}=t,i=e.canvas.parentNode.querySelector(".chart-tooltip");if(!i)return;if(0===s.opacity)return void(i.style.opacity=0);const a=s.dataPoints[0].dataIndex,n=e.data.datasets[0],r=e.data.datasets[1];i.innerHTML=`<div><b style="background: ${n.color};"></b><span>${n.data[a]}</span></div>\n              <div><b style="background: ${r.color};"></b><span>${r.data[a]}</span></div>`,i.style.opacity=1,i.style.left=e.canvas.offsetLeft+s.caretX-i.clientWidth-6+"px",i.style.top=e.canvas.offsetTop+s.caretY-i.clientHeight-6+"px"}}},responsive:!0,maintainAspectRatio:!1}};this.chart=new i.Ay(t,a({},n,e)),window.addEventListener("resize",(()=>this.resizeChart()))}resizeChart(){this.chart&&this.chart.update("resize")}}},7846:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(9244);const a=class{constructor(t,e={}){if(!t)throw new Error("Slider element is required.");this.defaultOptions={start:[20,80],range:{min:0,max:100}},this.options={...this.defaultOptions,...e},this.sliderElement=t,this.slider=noUiSlider.create(this.sliderElement,this.options),this.onSliderUpdate=()=>{},this.onSliderSlide=()=>{},this.sliderElement.noUiSlider.on("update",this._onSliderUpdate.bind(this)),this.sliderElement.noUiSlider.on("slide",this._onSliderSlide.bind(this))}_onSliderUpdate(t,e){"function"==typeof this.onSliderUpdate&&this.onSliderUpdate(t,e)}_onSliderSlide(t,e){"function"==typeof this.onSliderSlide&&this.onSliderSlide(t,e)}},n=class{constructor(t,e={},s){t&&(this.defaultOptions={duration:0,allowHTML:!0,content:"<div>Пусто</div>",trigger:"click",placement:"bottom-start",interactive:!0,appendTo:document.body},this.defaultFilterValues=s,this.filterParams={...this.defaultFilterValues},this.options=Object.assign({},this.defaultOptions,e),this.onOpen=()=>{},this.onClose=()=>{},this.onInput=()=>{},this.onApply=()=>{},this.onClear=()=>{},this.instanceTippy=(0,i.Ay)(t,{onTrigger:(t,e)=>this.onOpen(t,e),onShow:()=>{},onHide:t=>this.onClose(t),...this.options}),this.button=t,this.inputs=[],this.btnApply=[],this.btnClear=[],this.rangeFilters=[],this.rangeSlider=[],this.isSync=!1,this.init(t))}init(t){if(t.length){for(let e=0;e<t.length;e++)this.inputs.push(...this.instanceTippy[e].popper.querySelectorAll(".input-filter")),this.btnApply.push(this.instanceTippy[e].popper.querySelector(".btn-filter-apply")),this.btnClear.push(this.instanceTippy[e].popper.querySelector(".btn-filter-clear")),this.rangeFilters.push(...this.instanceTippy[e].popper.querySelectorAll(".range-filter"));this.isSync=!0}else this.inputs=[...this.instanceTippy.popper.querySelectorAll(".input-filter")],this.btnApply=[this.instanceTippy.popper.querySelector(".btn-filter-apply")],this.btnClear=[this.instanceTippy.popper.querySelector(".btn-filter-clear")],this.rangeFilters=[...this.instanceTippy.popper.querySelectorAll(".range-filter")];this.attachEvents()}attachEvents(){this.inputs.length&&this.inputs.forEach((t=>{const[e,s]=t.name.split("_");t.addEventListener("input",(()=>this.handleInput(t,[e,s]))),t.addEventListener("keydown",(i=>this.handleArrowKeys(t,i,[e,s])))})),this.rangeFilters.length&&this.rangeFilters.forEach((t=>{const[e,s]=t.getAttribute("data-name").split(","),i=new a(t,{start:[this.defaultFilterValues[e],this.defaultFilterValues[s]],range:{min:this.defaultFilterValues[e],max:this.defaultFilterValues[s]},step:1});i.onSliderSlide=(t,e)=>this.handleSliderSlide(t,e,i),this.rangeSlider.push(i)})),this.btnApply.length&&this.btnApply.forEach((t=>t.addEventListener("click",(()=>this.handleBtnApply())))),this.btnClear.length&&this.btnClear.forEach((t=>t.addEventListener("click",(()=>this.handleBtnClear()))))}handleInput(t,[e,s]){this.validateAndCorrect(t,[e,s]),this.onInput()}handleArrowKeys(t,e,[s,i]){const a=+t.getAttribute("data-step"),n=a>=1?0:1,r=this.defaultFilterValues[`${s}_end`];let l=parseFloat(t.value)||0;"ArrowUp"===e.key&&l<r?(l+=a,t.value=l.toFixed(n),e.preventDefault()):"ArrowDown"===e.key&&l>0&&(l-=a,t.value=l.toFixed(n),e.preventDefault()),this.validateAndCorrect(t,[s,i])}handleBtnApply(){this.isSync?this.forInstance((t=>t.hide())):this.instanceTippy.hide(),this.onApply(this.filterParams)}handleBtnClear(){this.inputs.length&&this.inputs.forEach((t=>{t.value=this.defaultFilterValues[t.name],this.changeParams(t,t.value)})),this.rangeSlider.length&&this.rangeSlider.forEach((t=>{t.slider.set(t.options.start)})),this.onClear(this.filterParams)}handleSliderSlide(t,e,s){const i=parseInt(t[e]),a=s.sliderElement.getAttribute("data-name").split(","),n=s.sliderElement.parentElement.querySelector(`[name="${a[e]}"]`);n.value=i,this.isSync&&this.syncFilters(n),this.changeParams(n,n.value)}updateSliderSlide(t,e=!1){const s=t.closest(".filter__block").querySelector(".range-filter");if(s&&this.rangeSlider.length){const i=this.rangeSlider.filter((t=>t.sliderElement.dataset.name===s.dataset.name)),[a,n]=t.name.split("_"),r="start"===n?0:1;i.length&&i.forEach((i=>{if(i.sliderElement==s&&e)return;const a=i.slider.get();a[r]=t.value,i.slider.set(a)}))}}fractionalNumber(t,e){let s=t.value;return/^\d+(\.\d)?$/.test(s)||(s=parseFloat(s).toFixed(1),t.value=isNaN(s)?"":s),parseFloat(s)>e&&(s=e,t.value=s),s}validateAndCorrect(t,[e,s]){const i=this.defaultFilterValues[`${e}_end`];let a=this.fractionalNumber(t,i);if("start"===s){const s=Array.from(this.inputs).find((t=>t.name===`${e}_end`));s&&parseFloat(a)>parseFloat(s.value)&&(t.value=s.value)}else if("end"===s){const s=Array.from(this.inputs).find((t=>t.name===`${e}_start`));s&&parseFloat(a)<parseFloat(s.value)&&(t.value=s.value)}this.isSync&&this.syncFilters(t),this.changeParams(t,t.value),this.updateSliderSlide(t)}changeParams(t,e){this.filterParams[t.name]=+e}forInstance(t=(()=>{})){for(let e=0;e<this.button.length;e++)t(this.instanceTippy[e])}syncFilters(t){const e=this.inputs.filter((e=>e!==t&&e.name===t.name));e.length&&e.forEach((e=>{e.value=t.value})),this.updateSliderSlide(t,!0)}}},6955:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(7846);class a extends i.A{constructor(t,e={}){super(t,{content:'\n  <div class="filter">\n    <div class="filter__content">\n      <div class="filter__block">\n        <span class="filter__block_name">Площадь:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="area_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="area_end" value="10" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Цена:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="price_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="price_end" value="30000" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="1">\n          </div>\n        </div>\n        <div class="filter__range range-filter" data-name="price_start,price_end"></div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Длина:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="length_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="length_end" value="4" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Ширина:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="width_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="width_end" value="3" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n      <div class="filter__block">\n        <span class="filter__block_name">Высота:</span>\n        <div class="filter__block_content">\n          <div class="filter__wp-input">\n            <span class="pref">от</span>\n            <input type="text" name="height_start" value="0" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n          <div class="filter__wp-input">\n            <span class="pref">до</span>\n            <input type="text" name="height_end" value="4" class="filter__input input-filter" inputmode="decimal" autocomplete="off" data-step="0.1">\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="filter__footer">\n      <button class="filter__button button btn-filter-apply"><span>Применить</span></button><button\n        class="filter__button button transparent btn-filter-clear"><span>Очистить фильтр</span></button>\n    </div>\n  </div>',...e},{area_start:0,area_end:10,price_start:0,price_end:3e4,length_start:0,length_end:4,width_start:0,width_end:3,height_start:0,height_end:4})}}const n=a},4513:(t,e,s)=>{s.d(e,{A:()=>i});const i=class{constructor(t){this.wrapper=t,this.schemes=t.querySelectorAll(".scheme"),this.numRooms={},this.init()}init(){this.schemes.length&&(this.cells=this.wrapper.querySelectorAll(".warehouse__svg-cell"))}changeActive(t){this.schemes.forEach(((e,s)=>{const i=e.closest(".wrap-scheme");t-1===s?i.classList.add("_active"):i.classList.remove("_active")}))}filterCell(t){this.actionsCell((({cell:e,cellId:s})=>{const i=this.numRooms[s]?.rented;void 0===i||-1!=+t&&+t!=+i?e.removeAttribute("data-rented"):e.setAttribute("data-rented",i)}))}actionsCell(t=(()=>{})){this.cells.forEach((e=>{const s=e.getAttribute("data-cell-num");t({cell:e,cellId:s})}))}render(t){if(!this.schemes.length)return;const{plan_rooms:e}=t;this.setNumRooms(e),this.actionsCell((({cell:t,cellId:e})=>{this.numRooms[e]?t.setAttribute("data-rented",this.numRooms[e].rented):t.removeAttribute("data-rented")}))}setNumRooms(t){this.numRooms={},t.forEach((t=>this.numRooms[t.room_id]=t))}}},8829:(t,e,s)=>{s.r(e),s.d(e,{default:()=>r});var i=s(6353),a=s(2302),n=s(3943);const r=class{constructor({loader:t,tables:e=[],charts:s=[],page:i}){this.loader=t,this.wrapper=document.querySelector(`[data-content="dashboards/${i}"]`),this.formFilter=this.wrapper.querySelector(".form-filter-dashboards"),this.tables=[],this.charts=[],e.length&&e.forEach((t=>{const{TableComponent:e,tableSelector:s,options:i={},params:a={}}=t;this.table=new e(s,{...i,wrapper:this.wrapper},a),this.tables.push(this.table)})),s.length&&s.forEach((t=>{const{id:e,ChartComponent:s,options:i={}}=t,a=new s(this.wrapper.querySelector(`#${e}`),i);this.charts.push(a)})),this.queryParams={},this.widgets=this.wrapper.querySelectorAll("[data-render-widget]"),this.init(i)}init(t){this.formFilter&&(this.selectFilter=new i.l({uniqueName:"select-filter-main",parentEl:this.wrapper}),this.calendars=(0,a.d)(`[data-content="dashboards/${t}"] .input-date-filter`,{mode:"range",dateFormat:"d. M, Y",onChange:(t,e,s)=>{2===t.length&&this.changeQueryParams({start_date:(0,n.p)(t[0],"YYYY-MM-DD"),end_date:(0,n.p)(t[1],"YYYY-MM-DD")})}})),this.events()}events(){this.tables.length&&this.actionsTables((t=>{t.onPageChange=e=>this.renderTable(t,{page:e}),t.onChangeTypeUser=({e,select:s,optionValue:i})=>this.renderTable(t,{user_type:i}),t.onValueInputSearch=e=>{""!==e?this.renderTable(t,{search_str:e}):this.renderTable(t)}})),this.selectFilter&&(this.selectFilter.onChange=(t,e,s)=>{const i=e.getAttribute("data-name"),a={[i]:s};this.changeQueryParams(a)})}changeQueryParams(t){this.queryParams={...this.queryParams,...t},this.renderDashboard(t)}renderWidgets(t){this.widgets.length&&this.widgets.forEach((e=>{const s=e.getAttribute("data-render-widget"),[i,a]=s.split(","),n=t[i]?t[i]+`${a||""}`:"В процессе доработки";t[i]||(e.style.fontSize="16px"),e.innerHTML=n}))}actionsTables(t=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((e=>{t(e)}))}actionsCharts(t=(()=>{})){this.charts.length&&this.charts.forEach((e=>{t(e)}))}async render(){try{this.loader.enable();const[t,e]=await Promise.all([this.getDashboardData(),this.getData()]);t&&(this.renderWidgets(t),this.actionsCharts((e=>e.render(t)))),this.tables.length&&e&&this.actionsTables((t=>t.render(e)))}catch(t){console.error(t)}finally{this.loader.disable()}}async renderDashboard(t){try{this.loader.enable(),await this.getDashboardData(t)}catch(t){console.error(t)}finally{this.loader.disable()}}async renderTable(t,e={}){try{this.loader.enable();const s=await this.getData(e);t.render(s)}catch(t){console.error(t)}finally{this.loader.disable()}}}},6643:(t,e,s)=>{s.r(e),s.d(e,{default:()=>g});var i=s(8829),a=s(4513),n=s(1037),r=s(182),l=s(6353);function o(t,e,s){return Array.from({length:t},(()=>Math.floor(Math.random()*(s-e+1))+e))}class d extends n.A{constructor(t,e){const s=t.getContext("2d").createLinearGradient(0,0,0,400);s.addColorStop(0,"rgba(60, 80, 224, 0.1)"),s.addColorStop(1,"rgba(60, 80, 224, 0.01)");const i={type:"line",data:{labels:["Янв","Фев","Март","Апр","Май","Июнь","Июль","Авг","Сент","Окт","Нояб","Дек"],datasets:[{label:"Факт",data:o(12,0,50),borderColor:"#3c50e0",color:"#3c50e0",pointBackgroundColor:"#fff",backgroundColor:s,pointRadius:0,fill:!0,tension:.6},{label:"План",data:o(12,0,50),borderColor:"#6f7d90",color:"#6f7d90",pointRadius:0,pointBackgroundColor:"#fff",backgroundColor:s,borderWidth:2,borderDash:[5,5],fill:!1,tension:.6}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!0}}}};super(t,r({},i,e)),this.datasets={plan:()=>{this.chart.data.datasets[0].hidden=!0,this.chart.data.datasets[1].hidden=!1,this.chart.update()},fact:()=>{this.chart.data.datasets[0].hidden=!1,this.chart.data.datasets[1].hidden=!0,this.chart.update()},planFact:()=>{this.chart.data.datasets[0].hidden=!1,this.chart.data.datasets[1].hidden=!1,this.chart.update()}},this.selects=new l.l({uniqueName:"select-chart-area-rented-cells",selectMinWidth:125}),this.selects.onChange=this.handleSelectChange.bind(this)}handleSelectChange(t,e,s){this.datasets[s]&&this.datasets[s]()}render(){}}const h=d;class c extends n.A{constructor(t,e={}){super(t,r({},{type:"doughnut",data:{labels:["Свободные","Забронированные","Занятые"],datasets:[{data:[20,60,20],backgroundColor:["#3b50e1","#ACB3E4","#8fd0ef"],hoverOffset:4}]},options:{cutout:"70%",plugins:{legend:{display:!1}},scales:{x:{display:!1,gridLines:{display:!1}},y:{display:!1,gridLines:{display:!1}}}}},e)),this.rooms=[],this.wp=this.chart.canvas.closest(".chart"),this.countCellsEl=this.wp.querySelector(".count-cells b"),this.widgets=this.wp.querySelectorAll("[data-chart-widget]"),this.datasets={1:()=>{const t=this.rooms.filter((t=>1===t.floor));this.countCellsEl.textContent=t.length},2:()=>{const t=this.rooms.filter((t=>2===t.floor));this.countCellsEl.textContent=t.length},all:()=>{this.countCellsEl.textContent=this.rooms.length}},this.selects=new l.l({uniqueName:"select-chart-cell-occupancy",selectMinWidth:125}),this.selects.onChange=this.handleSelectChange.bind(this)}handleSelectChange(t,e,s){this.datasets[s]&&this.datasets[s]()}render(t){const{rented_cnt:e=[],plan_rooms:s=[]}=t;if(this.rooms=s,!e.length)return;const[i=null]=e.filter((t=>0==+t.rented)),[a=null]=e.filter((t=>.5==+t.rented)),[n=null]=e.filter((t=>1==+t.rented));this.chart.data.datasets[0].data=[i?i.cnt:0,a?a.cnt:0,n?n.cnt:0],this.countCellsEl.textContent=s.length,this.widgets.length&&this.widgets.forEach((t=>{const s=+t.getAttribute("data-chart-widget"),[i=null]=e.filter((t=>+t.rented===s));t.innerText=i?`${i.rate}%`:"0%"})),this.chart.update()}}const p=c;var u=s(6955),f=s(1014);class m extends i.default{constructor({loader:t}){super({loader:t,page:"warehouse",charts:[{id:"chart-area-rented-cells",ChartComponent:h},{id:"chart-cell-occupancy",ChartComponent:p}]}),this.warehouseScheme=new a.A(this.wrapper),this.currentRented=null}init(){this.wrapper&&(this.selectWarehouseFloors=new l.l({uniqueName:"select-warehouse-floors",parentEl:this.wrapper}),this.filterRooms=new u.A(this.wrapper.querySelector(".btn-set-filters")),this.events())}events(){this.wrapper.addEventListener("click",(t=>{t.target.closest(".btn-filter-scheme:not(._active)")&&this.handleClickFilterScheme(t)})),this.selectWarehouseFloors.onChange=(t,e,s)=>{this.warehouseScheme.changeActive(+s)},this.filterRooms.onApply=t=>this.renderScheme(t)}handleClickFilterScheme(t){const e=t.target.closest(".btn-filter-scheme"),s=this.wrapper.querySelector(".btn-filter-scheme._active"),i=e.getAttribute("data-rented");e.classList.add("_active"),s?.classList.remove("_active"),this.currentRented=i,this.warehouseScheme.filterCell(i)}renderWidgets(t){this.widgets.length&&this.widgets.forEach((e=>{const{rented_cnt:s}=t,i=+e.getAttribute("data-render-widget"),[a=null]=s.filter((t=>+t.rented===i));e.innerText=a?`${a.rate}% (${a.cnt})`:"В процессе доработки"}))}async render(){try{this.loader.enable();const[t,e]=await Promise.all([(0,f.Wy)(),(0,f.t8)()]);this.renderWidgets(t),this.actionsCharts((e=>e.render(t))),e&&this.warehouseScheme.render(e)}catch(t){console.error(t)}finally{this.loader.disable()}}async renderScheme(t={}){try{this.loader.enable();const e=await(0,f.t8)(t);e&&(this.currentRented?(this.warehouseScheme.setNumRooms(e.plan_rooms),this.warehouseScheme.filterCell(this.currentRented)):this.warehouseScheme.render(e))}catch(t){console.error(t)}finally{this.loader.disable()}}}const g=m}}]);