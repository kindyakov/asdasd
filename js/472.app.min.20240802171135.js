"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[472,829],{1037:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(8868),s=a(182);const r=class{constructor(e,t={}){const a={minRotation:0,maxRotation:0,color:"#64748b",font:{size:14,weight:500,family:"Manrope"}},r={options:{scales:{x:{ticks:a,border:{width:0},grid:{color:"#f3f3f3",lineWidth:1}},y:{ticks:a,grid:{color:"#f3f3f3",lineWidth:1},border:{width:0}}},plugins:{legend:{display:!1},tooltip:{enabled:!1,external:function(e){const{chart:t,tooltip:a}=e,n=t.canvas.parentNode.querySelector(".chart-tooltip");if(!n)return;if(0===a.opacity)return void(n.style.opacity=0);const s=a.dataPoints[0].dataIndex,r=t.data.datasets[0],i=t.data.datasets[1];n.innerHTML=`<div><b style="background: ${r.color};"></b><span>${r.data[s]}</span></div>\n              <div><b style="background: ${i.color};"></b><span>${i.data[s]}</span></div>`,n.style.opacity=1,n.style.left=t.canvas.offsetLeft+a.caretX-n.clientWidth-6+"px",n.style.top=t.canvas.offsetTop+a.caretY-n.clientHeight-6+"px"}}},responsive:!0,maintainAspectRatio:!1}};this.chart=new n.Ay(e,s({},r,t)),window.addEventListener("resize",(()=>this.resizeChart()))}resizeChart(){this.chart&&this.chart.update("resize")}}},3349:(e,t,a)=>{a.d(t,{A:()=>h});var n=a(3282),s=(a(9706),a(3711)),r=a(6047),i=a(2346),l=a(9661),o=a(3943),d=a(1014);class c extends n.A{constructor(e,t,a){const n={columnDefs:[{headerCheckboxSelection:!0,checkboxSelection:!0,width:50,resizable:!1,sortable:!1},{headerName:"Договор",field:"agrid",minWidth:80,flex:.3,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-agrid"),t.textContent=e.value?(0,i.H)(e.value):"нет",(0,l.a)(e,{el:t})}},{headerName:"ФИО",field:"fullname",minWidth:300,flex:1,cellRenderer:e=>(0,l.a)(e,{iconId:"profile"})},{headerName:"Дата начала",field:"agrbegdate",minWidth:130,flex:.6,cellRenderer:e=>(0,l.a)(e,{funcFormate:o.p,iconId:"calendar"})},{headerName:"Платеж в мес.",field:"price",minWidth:100,flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-price"),t.innerHTML=e.value?(0,r.F)(e.value):"нет",(0,l.a)(e,{el:t})}},{headerName:"Ячейки",field:"room_ids",minWidth:70,flex:.5,valueFormatter:e=>e.value?(0,i.H)(e.value):"нет"},{headerName:"Конец договора",field:"agrplanenddate",minWidth:100,flex:.5,valueFormatter:e=>e.value?(0,o.p)(e.value):"нет"},{headerName:"Способ оплаты",field:"last_payment_type",minWidth:100,flex:.5},{headerName:"Действия",field:"actions",width:80,cellRenderer:e=>this.actionCellRenderer(e),resizable:!1,sortable:!1}]};super(e,Object.assign({},n,t),Object.assign({},{selectTypeUser:!0,onChangeTypeUser:()=>{}},a)),this.actionCellRenderer=this.actionCellRenderer.bind(this),this.enableEditing=this.enableEditing.bind(this),this.onChangeTypeUser=this.params.onChangeTypeUser}actionCellRenderer(e){const{user_id:t,user_type:a}=e.data,n=(e.eGridCell.closest(".ag-row"),document.createElement("button"));return n.classList.add("button-table-actions"),n.innerHTML="<span></span><span></span><span></span><svg class='icon icon-check'><use xlink:href='img/svg/sprite.svg#check'></use></svg>",(0,s.o)(n,{onOpen:()=>{},attrModal:"modal-agreement",data:e.data}),n}render(e){const{agreements:t,cnt_pages:a,page:n}=e;this.setPage(n,a),this.gridApi.setGridOption("rowData",t),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,t.length])}async download(e){try{this.loader.enable();let t={};if(e.length){const a=e.map((e=>e.agrid));t.all_agrs=0,t.agrids=a}else t.all_agrs=1;await(0,d.PC)(t)}catch(e){console.error(e)}finally{this.loader.disable()}}}const h=c},3711:(e,t,a)=>{a.d(t,{o:()=>r});var n=a(9244);let s={tippyInstance:null,isEdit:!1,buttons:[(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-edit-row-table"),t.innerHTML="\n      <svg class='icon icon-edit'>\n        <use xlink:href='img/svg/sprite.svg#edit'></use>\n      </svg>\n      <span>Редактировать</span>",t},(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-open"),t.innerHTML="\n      <svg class='icon icon-arrow-right-circle' styles=\"fill: none;\">\n        <use xlink:href='img/svg/sprite.svg#arrow-right-circle'></use>\n      </svg>\n      <span>Открыть</span>",t}],onEdit:()=>{},onEnableEdit:()=>{},onOpen:()=>{}};function r(e,t={}){const a=Object.assign({toggleEdit:i,toggleActive:l},s,t),r=(0,n.Ay)(e,{allowHTML:!0,trigger:"click",content:t=>{const n=document.createElement("div");function s(t){t.target.closest(".btn-edit-row-table")&&(i(e),a.isEdit=!0,a.onEnableEdit(a)),a.tippyInstance.hide()}return n.classList.add("tippy","table-tippy-client"),a.buttons.forEach((e=>{const t=e();t.setAttribute("data-json",JSON.stringify(a.data)),t.classList.contains("btn-open")&&t.setAttribute("data-modal",a.attrModal),t.addEventListener("click",s),n.appendChild(t)})),n},maxWidth:180,duration:0,placement:"bottom-start",interactive:!0,appendTo:document.body,onTrigger(e,t){a.tippyInstance=e,a.isEdit&&a.onEdit(a)},onShow(t){if(a.isEdit)return!1;l(e)},onHide(t){l(e)}});function i(e){e.classList.toggle("_edit")}function l(e){e.classList.toggle("_active")}return r.options=a,r}},2346:(e,t,a)=>{function n(e){let t,a;return a=Array.isArray(e)?e:e.split(",").map((e=>e.trim())),t=a.map((e=>`№${e}`)),t.join(", ")}a.d(t,{H:()=>n})},9661:(e,t,a)=>{a.d(t,{a:()=>r});var n=a(2783);const s={funcFormate:e=>e,iconId:null,el:null,inputmode:"text",attributes:[]};function r(e,t={}){const{funcFormate:a,iconId:r,el:i,inputmode:l,attributes:o}=Object.assign({},s,t),d=(0,n.n)("div",["wp-input","wp-input-cell","not-edit"]);let c="";if(i&&(d.classList.add("is-dop-content"),i.classList.add("dop-el-content")),r){const e=`<svg class='icon icon-${r}'><use xlink:href='img/svg/sprite.svg#${r}'></use></svg>`;d.insertAdjacentHTML("afterbegin",e),d.classList.add("is-icon")}return o.length&&(c=o.map((e=>`${e[0]}="${e[1]}"`)).join(" ")),d.insertAdjacentHTML("beforeend",`<input type="text" name="${e.colDef.field}" value="${e.value?a(e.value):""}" class="input-cell cell-input not-edit" autocomplete="off" readonly="true" inputmode="${l}" ${c}>${i?i.outerHTML:""}`),d}},8829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(6353),s=a(2302),r=a(3943);const i=class{constructor({loader:e,tables:t=[],charts:a=[],page:n}){this.loader=e,this.wrapper=document.querySelector(`[data-content="dashboards/${n}"]`),this.formFilter=this.wrapper.querySelector(".form-filter-dashboards"),this.tables=[],this.charts=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:a,options:n={},params:s={}}=e;this.table=new t(a,{...n,wrapper:this.wrapper},s),this.tables.push(this.table)})),a.length&&a.forEach((e=>{const{id:t,ChartComponent:a,options:n={}}=e,s=new a(this.wrapper.querySelector(`#${t}`),n);this.charts.push(s)})),this.queryParams={},this.widgets=this.wrapper.querySelectorAll("[data-render-widget]"),this.init(n)}init(e){this.formFilter&&(this.selectFilter=new n.l({uniqueName:"select-filter-main",parentEl:this.wrapper}),this.calendars=(0,s.d)(`[data-content="dashboards/${e}"] .input-date-filter`,{mode:"range",dateFormat:"d. M, Y",onChange:(e,t,a)=>{2===e.length&&this.changeQueryParams({start_date:(0,r.p)(e[0],"YYYY-MM-DD"),end_date:(0,r.p)(e[1],"YYYY-MM-DD")})}})),this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.renderTable(e,{page:t}),e.onChangeTypeUser=({e:t,select:a,optionValue:n})=>this.renderTable(e,{user_type:n}),e.onValueInputSearch=t=>{""!==t?this.renderTable(e,{search_str:t}):this.renderTable(e)}})),this.selectFilter&&(this.selectFilter.onChange=(e,t,a)=>{const n=t.getAttribute("data-name"),s={[n]:a};this.changeQueryParams(s)})}changeQueryParams(e){this.queryParams={...this.queryParams,...e},this.renderDashboard(e)}renderWidgets(e){this.widgets.length&&this.widgets.forEach((t=>{const a=t.getAttribute("data-render-widget"),[n,s]=a.split(","),r=e[n]?e[n]+`${s||""}`:"В процессе доработки";e[n]||(t.style.fontSize="16px"),t.innerHTML=r}))}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}actionsCharts(e=(()=>{})){this.charts.length&&this.charts.forEach((t=>{e(t)}))}async render(){try{this.loader.enable();const[e,t]=await Promise.all([this.getDashboardData(),this.getData()]);e&&(this.renderWidgets(e),this.actionsCharts((t=>t.render(e)))),this.tables.length&&t&&this.actionsTables((e=>e.render(t)))}catch(e){console.error(e)}finally{this.loader.disable()}}async renderDashboard(e){try{this.loader.enable(),await this.getDashboardData(e)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const a=await this.getData(t);e.render(a)}catch(e){console.error(e)}finally{this.loader.disable()}}}},8472:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var n=a(8829),s=a(3349),r=a(3282),i=(a(9706),a(3711)),l=a(6047),o=a(2346),d=a(9661),c=(a(2514),a(3943));class h extends r.A{constructor(e,t,a){const n={columnDefs:[{headerCheckboxSelection:!0,checkboxSelection:!0,width:50,resizable:!1,sortable:!1},{headerName:"Заявка №",field:"agrid",flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-agrid"),t.textContent=e.value?(0,o.H)(e.value):"нет",(0,d.a)(e,{el:t})}},{headerName:"ФИО",field:"fullname",flex:1,cellRenderer:e=>(0,d.a)(e,{iconId:"profile"})},{headerName:"Телефон",field:"",flex:.6,cellRenderer:e=>(0,d.a)(e,{funcFormate:c.p,iconId:"calendar"})},{headerName:"Сумма",field:"price",flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-price"),t.innerHTML=e.value?(0,l.F)(e.value):"нет",(0,d.a)(e,{el:t})}},{headerName:"Канал продаж",field:"",flex:.5,sortable:!1},{headerName:"Время сделки",field:"",flex:.5,valueFormatter:e=>e.value?(0,c.p)(e.value):"нет"},{headerName:"Статус",field:"status",flex:.5},{headerName:"Действия",field:"actions",flex:.4,cellRenderer:e=>this.actionCellRenderer(e),resizable:!1,sortable:!1}]};super(e,Object.assign({},n,t),Object.assign({},{selectTypeUser:!0,onChangeTypeUser:()=>{}},a)),this.actionCellRenderer=this.actionCellRenderer.bind(this),this.enableEditing=this.enableEditing.bind(this),this.onChangeTypeUser=this.params.onChangeTypeUser}actionCellRenderer(e){const{user_id:t,user_type:a}=e.data,n=(e.eGridCell.closest(".ag-row"),document.createElement("button"));return n.classList.add("button-table-actions"),n.setAttribute("data-user-id",t),n.setAttribute("data-user-type",a),n.innerHTML="<span></span><span></span><span></span><svg class='icon icon-check'><use xlink:href='img/svg/sprite.svg#check'></use></svg>",(0,i.o)(n,{onOpen:()=>{}}),n}render(e){}}const p=h;var u=a(1037),g=a(182),b=a(6353);function f(e,t,a){return Array.from({length:e},(()=>Math.floor(Math.random()*(a-t+1))+t))}class m extends u.A{constructor(e,t={}){const a=e.getContext("2d").createLinearGradient(0,0,0,400);a.addColorStop(0,"rgba(60, 80, 224, 0.1)"),a.addColorStop(1,"rgba(60, 80, 224, 0.01)");const n={type:"line",data:{labels:Array.from({length:30},((e,t)=>t+1)),datasets:[{label:"Факт",data:f(30,5,35),borderColor:"#3c50e0",color:"#3c50e0",pointBackgroundColor:"#fff",backgroundColor:a,pointRadius:4,fill:!0,tension:.6},{label:"План",data:f(30,5,24),borderColor:"#6f7d90",color:"#6f7d90",pointRadius:0,pointBackgroundColor:"#fff",backgroundColor:a,borderWidth:2,borderDash:[5,5],fill:!1,tension:.6}]},options:{scales:{y:{beginAtZero:!0}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!0}}}};super(e,g({},n,t)),this.datasets={plan:()=>{this.chart.data.datasets[0].hidden=!0,this.chart.data.datasets[1].hidden=!1,this.chart.update()},fact:()=>{this.chart.data.datasets[0].hidden=!1,this.chart.data.datasets[1].hidden=!0,this.chart.update()},planFact:()=>{this.chart.data.datasets[0].hidden=!1,this.chart.data.datasets[1].hidden=!1,this.chart.update()}},this.selects=new b.l({uniqueName:"select-chart-conversion",selectMinWidth:125}),this.selects.onChange=this.handleSelectChange.bind(this)}handleSelectChange(e,t,a){this.datasets[a]&&this.datasets[a]()}render(){}}const y=m;var v=a(1014);class C extends n.default{constructor({loader:e}){super({loader:e,tables:[{tableSelector:".table-agreements",TableComponent:s.A},{tableSelector:".table-transactions",TableComponent:p}],charts:[{id:"chart-conversions",ChartComponent:y}],page:"plan-fact"})}async getData(e={}){return(0,v.Y4)(e)}async getDashboardData(){return[]}}const w=C}}]);