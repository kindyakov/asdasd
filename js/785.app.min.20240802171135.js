"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[785,291],{6694:(e,t,a)=>{a.d(t,{A:()=>g});var n=a(3282),i=a(4429),s=a(2302),r=a(9706),l=a(1014),o=a(3711),d=a(6047),c=a(2346),u=a(9661),p=a(3943),h=a(2514);class m extends n.A{constructor(e,t,a){const n={columnDefs:[{headerCheckboxSelection:!0,checkboxSelection:!0,width:50,resizable:!1,sortable:!1},{headerName:"Договор",field:"agrid",minWidth:80,flex:.3,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-agrid"),t.textContent=e.value?(0,c.H)(e.value):"нет",(0,u.a)(e,{el:t})}},{headerName:"ФИО",field:"fullname",minWidth:300,flex:.8,cellRenderer:e=>(0,u.a)(e,{iconId:"profile"})},{headerName:"Дата платежа",field:"payment_date",minWidth:130,flex:.5,cellRenderer:e=>(0,u.a)(e,{funcFormate:p.p,iconId:"calendar"})},{headerName:"Вид поступления",field:"type",minWidth:100,flex:.5},{headerName:"Статья учета",field:"account_article",minWidth:80,flex:.5},{headerName:"Сумма",field:"amount",minWidth:90,flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-price"),t.innerHTML=e.value?(0,d.F)(e.value):"нет",(0,u.a)(e,{el:t})}},{headerName:"Сотрудник",field:"manager_name",minWidth:90,flex:.5},{headerName:"Физ./Юр.",field:"user_type",minWidth:90,flex:.5,valueFormatter:e=>"f"===e.value?"Физ. лицо":"Юр. лицо"},{headerName:"Действия",field:"actions",minWidth:80,flex:.5,resizable:!1,sortable:!1,cellRenderer:e=>this.actionCellRenderer(e)}]};super(e,Object.assign({},n,t),Object.assign({},{selectTypeUser:!0,onChangeTypeUser:()=>{}},a)),this.actionCellRenderer=this.actionCellRenderer.bind(this)}actionCellRenderer(e){const{agrid:t,user_type:a,payment_id:n}=e.data,r=e.eGridCell.closest(".ag-row"),l=document.createElement("button");let d;l.classList.add("button-table-actions"),l.innerHTML="<span></span><span></span><span></span><svg class='icon icon-check'><use xlink:href='img/svg/sprite.svg#check'></use></svg>";const c=(0,o.o)(l,{attrModal:"modal-agreement",data:e.data});return c.options.onEdit=e=>{this.validatorRow?.revalidate().then((t=>{if(t){const t=new FormData(d);let a={payment_id:n};t.set("payment_date",(0,p.p)(t.get("payment_date"),"YYYY-MM-DD")),Array.from(t).forEach((e=>a[e[0]]=e[1])),this.editPayment(a).finally((()=>{e.toggleEdit(l),e.isEdit=!1,this.disableEditing(r),this.validatorRow.destroy()}))}}))},c.options.onEnableEdit=()=>{d=document.createElement("form");const e=this.enableEditing(r),t={};e.forEach((e=>{const a=e.cloneNode(!0);a.value=e.value,t[e.name]=e,d.appendChild(a),e.addEventListener("input",(()=>{a.value=e.value,this.validatorRow?.revalidateField(a).then((t=>{e.value=a.value,t?e.classList.remove("just-validate-error-field"):e.classList.add("just-validate-error-field")}))}))})),this.validatorRow=function(e,t={}){if(!e)return;const a=(0,i.f)(e,t),n=(0,s.d)(t.inputsObj.payment_date,{dateFormat:"d.m.Y"});return a.addField(e.querySelector('input[name="payment_date"]'),[{rule:"required"}]).addField(e.querySelector('input[name="amount"]'),[{rule:"required"},{validator:(e,t)=>{const a=t[2].elem;return a.value=e.replace(/[^0-9]/g,""),Number.isInteger(+a.value)}}]).addField(e.querySelector('input[name="fullname"]'),[{rule:"required"},{rule:"customRegexp",value:/^[А-ЯЁа-яё\s]+$/,errorMessage:"Неверный формат"}]).addField(e.querySelector('input[name="agrid"]'),[{rule:"required"},{validator:(e,t)=>{const a=t[4].elem;return a.value=e.replace(/[^0-9]/g,""),Number.isInteger(+a.value)}}]),a.onDestroy=()=>{n.destroy()},a}(d,{inputsObj:t})},l}render(e){const{payments:t,cnt_pages:a,page:n}=e;this.setPage(n,a),this.gridApi.setGridOption("rowData",t),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,t.length])}async editPayment(e){try{this.loader.enable();const t=await r.F.post("/_edit_payment_",e);if(200!==t.status)return;(0,h.G)(t.data)}catch(e){console.error(e)}finally{this.loader.disable()}}async download(e){try{this.loader.enable();let t={};if(e.length){const a=e.map((e=>e.payment_id));t.all_payments=0,t.payment_ids=a}else t.all_payments=1;await(0,l.up)(t)}catch(e){console.error(e)}finally{this.loader.disable()}}}const g=m},3711:(e,t,a)=>{a.d(t,{o:()=>s});var n=a(9244);let i={tippyInstance:null,isEdit:!1,buttons:[(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-edit-row-table"),t.innerHTML="\n      <svg class='icon icon-edit'>\n        <use xlink:href='img/svg/sprite.svg#edit'></use>\n      </svg>\n      <span>Редактировать</span>",t},(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-open"),t.innerHTML="\n      <svg class='icon icon-arrow-right-circle' styles=\"fill: none;\">\n        <use xlink:href='img/svg/sprite.svg#arrow-right-circle'></use>\n      </svg>\n      <span>Открыть</span>",t}],onEdit:()=>{},onEnableEdit:()=>{},onOpen:()=>{}};function s(e,t={}){const a=Object.assign({toggleEdit:r,toggleActive:l},i,t),s=(0,n.Ay)(e,{allowHTML:!0,trigger:"click",content:t=>{const n=document.createElement("div");function i(t){t.target.closest(".btn-edit-row-table")&&(r(e),a.isEdit=!0,a.onEnableEdit(a)),a.tippyInstance.hide()}return n.classList.add("tippy","table-tippy-client"),a.buttons.forEach((e=>{const t=e();t.setAttribute("data-json",JSON.stringify(a.data)),t.classList.contains("btn-open")&&t.setAttribute("data-modal",a.attrModal),t.addEventListener("click",i),n.appendChild(t)})),n},maxWidth:180,duration:0,placement:"bottom-start",interactive:!0,appendTo:document.body,onTrigger(e,t){a.tippyInstance=e,a.isEdit&&a.onEdit(a)},onShow(t){if(a.isEdit)return!1;l(e)},onHide(t){l(e)}});function r(e){e.classList.toggle("_edit")}function l(e){e.classList.toggle("_active")}return s.options=a,s}},2346:(e,t,a)=>{function n(e){let t,a;return a=Array.isArray(e)?e:e.split(",").map((e=>e.trim())),t=a.map((e=>`№${e}`)),t.join(", ")}a.d(t,{H:()=>n})},9661:(e,t,a)=>{a.d(t,{a:()=>s});var n=a(2783);const i={funcFormate:e=>e,iconId:null,el:null,inputmode:"text",attributes:[]};function s(e,t={}){const{funcFormate:a,iconId:s,el:r,inputmode:l,attributes:o}=Object.assign({},i,t),d=(0,n.n)("div",["wp-input","wp-input-cell","not-edit"]);let c="";if(r&&(d.classList.add("is-dop-content"),r.classList.add("dop-el-content")),s){const e=`<svg class='icon icon-${s}'><use xlink:href='img/svg/sprite.svg#${s}'></use></svg>`;d.insertAdjacentHTML("afterbegin",e),d.classList.add("is-icon")}return o.length&&(c=o.map((e=>`${e[0]}="${e[1]}"`)).join(" ")),d.insertAdjacentHTML("beforeend",`<input type="text" name="${e.colDef.field}" value="${e.value?a(e.value):""}" class="input-cell cell-input not-edit" autocomplete="off" readonly="true" inputmode="${l}" ${c}>${r?r.outerHTML:""}`),d}},9291:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var n=a(3943),i=a(1417);const s=class{constructor({loader:e,tables:t=[],page:a}){this.loader=e,this.wrapper=document.querySelector(`[data-content="${a}"]`),this.tables=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:a,options:n={},params:i={}}=e;this.table=new t(a,{...n,wrapper:this.wrapper},i),this.tables.push(this.table)})),this.queryParams={},this.init(a)}onRender(){}init(e){this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.changeQueryParams({page:t},e),e.onValueInputSearch=t=>{let a={};a=""!==t?{search_str:t}:{},this.changeQueryParams(a,e)},e.selects.onChange=(t,a,n)=>{const i=a.getAttribute("data-name");this.changeQueryParams({[i]:n},e)},e.calendar&&(e.calendar.methods.onChange=(t,a,i)=>{if(2===t.length){const[a,s]=i.element.name.split(",");this.changeQueryParams({[a]:(0,n.p)(t[0],"YYYY-MM-DD"),[s]:(0,n.p)(t[1],"YYYY-MM-DD")},e)}})}))}changeQueryParams(e,t=null){this.queryParams=(0,i.$)(this.queryParams,e),t?this.renderTable(t,this.queryParams):this.render(this.queryParams)}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}async render(e={}){try{this.loader.enable();const t=await this.getData(e);this.tables.length&&t&&this.actionsTables((e=>e.render(t))),this.onRender(t)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const a=await this.getData(t);e?.render(a)}catch(e){console.error(e)}finally{this.loader.disable()}}}},4785:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var n=a(9291),i=a(6694),s=a(1014);class r extends n.default{constructor({loader:e}){super({loader:e,tables:[{tableSelector:".table-payments",TableComponent:i.A,options:{paginationPageSize:15}}],page:"payments"})}async getData(e={}){return(0,s.k5)(e)}}const l=r}}]);