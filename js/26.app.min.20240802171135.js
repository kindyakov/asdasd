"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[26,291],{9661:(t,e,a)=>{a.d(e,{a:()=>s});var n=a(2783);const i={funcFormate:t=>t,iconId:null,el:null,inputmode:"text",attributes:[]};function s(t,e={}){const{funcFormate:a,iconId:s,el:r,inputmode:l,attributes:o}=Object.assign({},i,e),d=(0,n.n)("div",["wp-input","wp-input-cell","not-edit"]);let c="";if(r&&(d.classList.add("is-dop-content"),r.classList.add("dop-el-content")),s){const t=`<svg class='icon icon-${s}'><use xlink:href='img/svg/sprite.svg#${s}'></use></svg>`;d.insertAdjacentHTML("afterbegin",t),d.classList.add("is-icon")}return o.length&&(c=o.map((t=>`${t[0]}="${t[1]}"`)).join(" ")),d.insertAdjacentHTML("beforeend",`<input type="text" name="${t.colDef.field}" value="${t.value?a(t.value):""}" class="input-cell cell-input not-edit" autocomplete="off" readonly="true" inputmode="${l}" ${c}>${r?r.outerHTML:""}`),d}},6325:(t,e,a)=>{a.d(e,{t:()=>n});class n{_groupedElements;_groupedButtons;_groupedContents;_buttonsActive;_contentsActive;constructor(t){this.options=Object.assign({specialSelector:"._my-tab-special",btnSelector:"._my-tab-btn",contentSelector:"._my-tab-content",classBtnActive:"_tab-btn-active",classContentActive:"_tab-content-active",activeIndexTab:0,isCheck:!0,uniqueName:!1,onChange:()=>{},onInit:()=>{}},t),this._groupedElements=[],this._groupedButtons=[],this._groupedContents=[],this._buttonsActive=new Set,this._contentsActive=new Set,this.clickHandler=this.clickHandler.bind(this),this.onChange=this.options.onChange,this.onInit=this.options.onInit,this.init()}get buttonsActive(){return Array.from(this._buttonsActive)}get contentActive(){return Array.from(this._contentsActive)}check(){return this.tabButtons.forEach((t=>{const e=t.getAttribute("data-tab-btn");if(!e)throw new Error(`Плагин myTabs: нет атрибута [data-tab-btn] или он пустой у кнопки ${t}`);const[a,n]=e.split(",");if(!a)throw new Error(`Плагин myTabs: В атрибуте [data-tab-btn="?,${n}"] не указан "name" у кнопки ${t}`);if(!n)throw new Error(`Плагин myTabs: В атрибуте [data-tab-btn="${a},?"] не указан "id" контента у кнопки ${t}`)})),this.tabContents.forEach((t=>{const e=t.getAttribute("data-tab-content");if(!e)throw new Error(`Плагин myTabs: нет атрибута [data-tab-content] или он пустой у блока ${t}`);const[a,n]=e.split(",");if(!a)throw new Error(`Плагин myTabs: В атрибуте [data-tab-content="?,${n}"] не указан "name" у блока ${t}`);if(!n)throw new Error(`Плагин myTabs: В атрибуте [data-tab-content="${a},?"] не указан "id" кнопки у блока ${t}`)})),!1}init(){this.options.uniqueName?(this.tabButtons=document.querySelectorAll(`${this.options.btnSelector}${this.options.specialSelector}`),this.tabContents=document.querySelectorAll(`${this.options.contentSelector}${this.options.specialSelector}`)):(this.tabButtons=document.querySelectorAll(`${this.options.btnSelector}:not(${this.options.specialSelector})`),this.tabContents=document.querySelectorAll(`${this.options.contentSelector}:not(${this.options.specialSelector})`)),this.tabButtons.length&&this.tabContents.length&&(this.options.isCheck&&this.check()||(this.groupElements(this.tabButtons,this._groupedButtons,"data-tab-btn"),this.groupElements(this.tabContents,this._groupedContents,"data-tab-content"),this._groupedButtons.forEach((t=>{let e=null;t.forEach(((t,a)=>{t.classList.remove(this.options.classBtnActive),""===t.getAttribute("data-tab-active")&&null===e&&(e=a)})),e=null!==e?e:this.options.activeIndexTab;const a=t[e],[n,i]=a.getAttribute("data-tab-btn").split(","),s=document.querySelector(`${this.options.contentSelector}[data-tab-content="${n},${i}"]`);a.classList.add(this.options.classBtnActive),this._buttonsActive.add(a),s.classList.add(this.options.classContentActive),this._contentsActive.add(s)})),this._groupedElements=Array.from(this.tabButtons).reduce(((t,e)=>{const[a]=e.getAttribute("data-tab-btn").split(",");return t[a]||(t[a]={buttons:[],contents:[]}),t[a].buttons.push(e),t}),{}),this.tabContents.forEach((t=>{const[e]=t.getAttribute("data-tab-content").split(",");this._groupedElements[e]&&this._groupedElements[e].contents.push(t)})),this.event(),this.onInit(this)))}clickHandler(t){let[e]=t.currentTarget.getAttribute("data-tab-btn").split(","),a=null;a=document.querySelector(`${this.options.btnSelector}[data-tab-name="${e}"].${this.options.classBtnActive}`),t.currentTarget!==a&&this.switchTabs(t.currentTarget,a)}event(){this.tabButtons.forEach(((t,e)=>{t.removeEventListener("click",this.clickHandler),t.addEventListener("click",this.clickHandler)}))}switchTabs(t,e=document.querySelector(`${this.options.btnSelector}[data-tab-name="${t.getAttribute("data-tab-name")}"].${this.options.classBtnActive}`)){if(!t||!e)return;const[a,n]=t.getAttribute("data-tab-btn").split(","),i=e.getAttribute("data-tab-id"),s=document.querySelector(`${this.options.contentSelector}[data-tab-content="${a},${i}"]`),r=document.querySelector(`${this.options.contentSelector}[data-tab-content="${a},${n}"]`);e.classList.remove(this.options.classBtnActive),t.classList.add(this.options.classBtnActive),s.classList.remove(this.options.classContentActive),r.classList.add(this.options.classContentActive),this._buttonsActive.delete(e),this._buttonsActive.add(t),this._contentsActive.delete(s),this._contentsActive.add(r),this.onChange({nextTabBtn:t,prevTabBtn:e,nextTabContent:r,prevTabContent:s})}groupElements(t,e,a){t.forEach((t=>{const[n,i]=t.getAttribute(a).split(",");let s=e.find((t=>t.length>0&&t[0].getAttribute(a).split(",")[0]===n));s||(s=[],e.push(s)),s.push(t),t.setAttribute("data-tab-name",n),t.setAttribute("data-tab-id",i)}))}}},3026:(t,e,a)=>{a.r(e),a.d(e,{default:()=>y});var n=a(9291),i=a(3282),s=a(2783),r=a(1169),l=a(9706);const o={numeric:function(t){return t.value=t.value.replace(/\D/g,""),t},decimal:function(t){return t.value=t.value.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/g,"$1"),t},price:function(t){function e(t){const e=t.replace(/[^-0-9]/g,"");let a="";if(e.length){for(let t=0;t<e.length;t++)t>0&&(e.length-t)%3==0&&(a+=","),a+=e[t];return a+" ₽"}return""}function a(a){if("Backspace"===a.key){a.preventDefault();let n=t.value.replace(/[^0-9]/g,"");n=n.slice(0,-1),t.value=n.length>0?e(n):""}}return t.value=e(t.value),t.removeEventListener("keydown",a),t.addEventListener("keydown",a),t}};var d=a(9661),c=a(2514);class h extends i.A{constructor(t,e,a){const n={columnDefs:[{headerName:"Период",field:"data",minWidth:80,flex:.5,valueFormatter:t=>{if(!t.value)return"";const e=/^\d{4}-\d{2}-\d{2}$/.test(t.value)?"dd.MM.yyyy":"yyyy, MMMM";return(0,r.R)(t.value,e)}},{headerName:"Количество лидов (план)",field:"leads_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{inputmode:"numeric"})},{headerName:"Количество лидов (факт)",field:"leads_fact",minWidth:80,flex:.6},{headerName:"% выполнения",field:"",minWidth:80,flex:.4},{headerName:"Количество лидов нарастающим итогом (план)",field:"leads_accumulated_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{inputmode:"numeric"})},{headerName:"Количество лидов нарастающим итогом (факт)",field:"leads_accumulated_fact",minWidth:80,flex:.5},{headerName:"% выполнения",field:"",minWidth:80,flex:.5,valueFormatter:t=>{const{leads_accumulated_fact:e,leads_accumulated_planned:a}=t.data;return+a?+e/+a*100+"%":"—"}},{headerName:"Сделок (план)",field:"sales_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{inputmode:"numeric"})},{headerName:"Сделок (факт)",field:"sales",minWidth:80,flex:.5},{headerName:"% выполнения",field:"",minWidth:80,flex:.4,resizable:!1,valueFormatter:t=>{const{sales:e,sales_planned:a}=t.data;return+a?+e/+a*100+"%":"—"}},{headerName:"",field:"",width:50,resizable:!1,cellRenderer:t=>this.btnEditCellRenderer(t)}]};super(t,Object.assign({},n,e),Object.assign({},{isPagination:!1},a)),this.emptyRow={},this.gridOptions.columnDefs.forEach((t=>t.field?this.emptyRow[t.field]=0:"")),this.data=[],this.btnEditCellRenderer=this.btnEditCellRenderer.bind(this),this.validateInputHandler=this.validateInput.bind(this),[this.select]=Array.from(this.selects.selects).filter((t=>"month_or_day"===t.name)),this.tableFooter=this.wpTable.querySelector(".ag-paging-panel"),this.agPagingPageSize=this.wpTable.querySelector(".ag-paging-page-size"),this.agPagingPageSize&&this.agPagingPageSize.remove(),this.btnAdd=this.wpTable.querySelector(".btn-table-add"),this.wrapButtons=(0,s.n)("div",["wrap-buttons"]),this.btnCancel=(0,s.n)("button",["button","transparent"],"<span>Отменить<span>"),this.btnAdd.addEventListener("click",this.addEmptyRow.bind(this)),this.btnCancel.addEventListener("click",this.handleClickBtnCancel.bind(this)),this.wrapButtons.appendChild(this.btnCancel),this.tableFooter.appendChild(this.wrapButtons)}render(t){const[e,{sales_planfact:a}]=t;this.data=a,this.gridApi.setGridOption("rowData",a),this.gridApi.setGridOption("paginationPageSize",a.length+20)}btnEditCellRenderer(t){const e=(0,s.n)("button",["button-table-row-edit"],"<svg class='icon icon-edit edit'>\n            <use xlink:href='img/svg/sprite.svg#edit'></use>\n          </svg>\n          <svg class='icon icon-save save'>\n            <use xlink:href='img/svg/sprite.svg#save'></use>\n          </svg>");return t.data.isNew&&this.toggleEditMode(t,e),e.addEventListener("click",(()=>this.toggleEditMode(t,e))),e}toggleEditMode(t,e){let{data:a}=t;const n=e.classList.toggle("_edit"),i=t.eGridCell.closest(".ag-row").querySelectorAll(".cell-input");i.length&&i.forEach((t=>{this.setReadonly(t,!n),n?t.addEventListener("input",this.validateInputHandler):(a[t.name]=+t.value,t.removeEventListener("input",this.validateInputHandler))})),n||(a.isNew&&(delete a.isNew,this.data=[...this.data,a]),this.setSalesPlan(a))}setReadonly(t,e){e?(t.setAttribute("readonly","true"),t.classList.add("not-edit")):(t.removeAttribute("readonly"),t.classList.remove("not-edit"))}validateInput(t){const e=t.target||t,a=e.getAttribute("inputmode"),n=o[a],i=n?n(e):e;return i.value?i.classList.remove("_err"):i.classList.add("_err"),!i.classList.contains("_err")}addEmptyRow(){let t={...this.emptyRow};t.data=(0,r.R)(new Date,"day"===this.select.value?"yyyy-MM-dd":"yyyy-MM"),t.isNew=!0,this.gridApi.applyTransaction({add:[t],addIndex:0})}handleClickBtnCancel(){this.gridApi.setGridOption("rowData",this.data)}async setSalesPlan(t){try{this.loader.enable();const e=await l.F.post("/_set_sales_plan_",t);if(200!==e.status)return;(0,c.G)(e.data)}catch(t){throw console.log(t),t}finally{this.loader.disable()}}}const u=h;var p=a(6047);class b extends i.A{constructor(t,e,a){const n={columnDefs:[{headerName:"Период",field:"data",minWidth:80,flex:.5,valueFormatter:t=>{if(!t.value)return"";const e=/^\d{4}-\d{2}-\d{2}$/.test(t.value)?"dd.MM.yyyy":"yyyy, MMMM";return(0,r.R)(t.value,e)}},{headerName:"Выручка план",field:"revenue_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{funcFormate:p.F,inputmode:"numeric"})},{headerName:"Выручка факт",field:"revenue",minWidth:80,flex:.5,valueFormatter:t=>(0,p.F)(t.value)},{headerName:"% выполнения",field:"",minWidth:80,flex:.4,valueFormatter:t=>{const{revenue:e,revenue_planned:a}=t.data;return+a?+e/+a*100+"%":"—"}},{headerName:"Выезды (м²) (план)",field:"outflow_area",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{inputmode:"decimal"})},{headerName:"Выезды (м²) (факт)\t% выполнения",field:"outflow_area_planned",minWidth:80,flex:.5},{headerName:"Заезды (м²) (план)",field:"inflow_area_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{inputmode:"decimal"})},{headerName:"Заезды (м²) (факт)",field:"inflow_area",minWidth:80,flex:.5},{headerName:"Выручка накопленным итогом (план)",field:"revenue_accumulated_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{funcFormate:p.F,inputmode:"numeric"})},{headerName:"Выручка накопленным итогом (факт)",field:"revenue_accumulated",minWidth:80,flex:.5,valueFormatter:t=>(0,p.F)(t.value)},{headerName:"Арендованная площадь (план)",field:"rented_area_planned",minWidth:80,flex:.5,cellRenderer:t=>(0,d.a)(t,{funcFormate:p.F,inputmode:"decimal"})},{headerName:"Арендованная площадь (факт)",field:"rented_area",minWidth:80,flex:.5},{headerName:"% выполнения",field:"",minWidth:80,flex:.6,resizable:!1,valueFormatter:t=>{const{rented_area:e,rented_area_planned:a}=t.data;return+a?+e/+a*100+"%":"—"}},{headerName:"",field:"",width:50,resizable:!1,cellRenderer:t=>this.btnEditCellRenderer(t)}]};super(t,Object.assign({},n,e),Object.assign({},{isPagination:!1},a)),this.emptyRow={},this.data=[],this.gridOptions.columnDefs.forEach((t=>t.field?this.emptyRow[t.field]=0:"")),this.btnEditCellRenderer=this.btnEditCellRenderer.bind(this),this.validateInputHandler=this.validateInput.bind(this),[this.select]=Array.from(this.selects.selects).filter((t=>"month_or_day"===t.name)),this.tableFooter=this.wpTable.querySelector(".ag-paging-panel"),this.agPagingPageSize=this.wpTable.querySelector(".ag-paging-page-size"),this.agPagingPageSize&&this.agPagingPageSize.remove(),this.btnAdd=this.wpTable.querySelector(".btn-table-add"),this.wrapButtons=(0,s.n)("div",["wrap-buttons"]),this.btnCancel=(0,s.n)("button",["button","transparent"],"<span>Отменить<span>"),this.btnAdd.addEventListener("click",this.addEmptyRow.bind(this)),this.btnCancel.addEventListener("click",this.handleClickBtnCancel.bind(this)),this.wrapButtons.appendChild(this.btnCancel),this.tableFooter.appendChild(this.wrapButtons)}render(t){const[{finance_planfact:e=[]}]=t;this.data=e,this.gridApi.setGridOption("rowData",e),this.gridApi.setGridOption("paginationPageSize",e.length+20)}btnEditCellRenderer(t){const e=(0,s.n)("button",["button-table-row-edit"],"<svg class='icon icon-edit edit'>\n            <use xlink:href='img/svg/sprite.svg#edit'></use>\n          </svg>\n          <svg class='icon icon-save save'>\n            <use xlink:href='img/svg/sprite.svg#save'></use>\n          </svg>");return t.data.isNew&&this.toggleEditMode(t,e),e.addEventListener("click",(()=>this.toggleEditMode(t,e))),e}toggleEditMode(t,e){let{data:a}=t;const n=e.classList.toggle("_edit"),i=t.eGridCell.closest(".ag-row").querySelectorAll(".cell-input");i.length&&i.forEach((t=>{this.setReadonly(t,!n),n?t.addEventListener("input",this.validateInputHandler):(a[t.name]=+t.value,t.removeEventListener("input",this.validateInputHandler))})),n||(a.isNew&&(delete a.isNew,this.data=[...this.data,a]),this.setFinancePlan(a))}setReadonly(t,e){e?(t.setAttribute("readonly","true"),t.classList.add("not-edit")):(t.removeAttribute("readonly"),t.classList.remove("not-edit"))}validateInput(t){const e=t.target||t,a=e.getAttribute("inputmode"),n=o[a],i=n?n(e):e;return i.value?i.classList.remove("_err"):i.classList.add("_err"),!i.classList.contains("_err")}addEmptyRow(){let t={...this.emptyRow};t.data=(0,r.R)(new Date,"day"===this.select.value?"yyyy-MM-dd":"yyyy-MM"),t.isNew=!0,this.gridApi.applyTransaction({add:[t],addIndex:0})}handleClickBtnCancel(){this.gridApi.setGridOption("rowData",this.data)}async setFinancePlan(t){try{this.loader.enable();const e=await l.F.post("/_set_finance_plan_",t);if(200!==e.status)return;(0,c.G)(e.data)}catch(t){throw console.log(t),t}finally{this.loader.disable()}}}const g=b;var m=a(1014),v=a(6325);class f extends n.default{constructor({loader:t}){super({loader:t,tables:[{tableSelector:".table-forecast",TableComponent:u,getData:m.c6,options:{paginationPageSize:15}},{tableSelector:".table-forecast-area",TableComponent:g,getData:m.A7,options:{paginationPageSize:15}}],page:"forecast"}),this.tabs=new v.t({classBtnActive:"_active",classContentActive:"_active",specialSelector:".forecast-tabs",uniqueName:!0})}async getData(t={}){return Promise.all([(0,m.A7)(t),(0,m.c6)(t)])}}const y=f},9291:(t,e,a)=>{a.r(e),a.d(e,{default:()=>s});var n=a(3943),i=a(1417);const s=class{constructor({loader:t,tables:e=[],page:a}){this.loader=t,this.wrapper=document.querySelector(`[data-content="${a}"]`),this.tables=[],e.length&&e.forEach((t=>{const{TableComponent:e,tableSelector:a,options:n={},params:i={}}=t;this.table=new e(a,{...n,wrapper:this.wrapper},i),this.tables.push(this.table)})),this.queryParams={},this.init(a)}onRender(){}init(t){this.events()}events(){this.tables.length&&this.actionsTables((t=>{t.onPageChange=e=>this.changeQueryParams({page:e},t),t.onValueInputSearch=e=>{let a={};a=""!==e?{search_str:e}:{},this.changeQueryParams(a,t)},t.selects.onChange=(e,a,n)=>{const i=a.getAttribute("data-name");this.changeQueryParams({[i]:n},t)},t.calendar&&(t.calendar.methods.onChange=(e,a,i)=>{if(2===e.length){const[a,s]=i.element.name.split(",");this.changeQueryParams({[a]:(0,n.p)(e[0],"YYYY-MM-DD"),[s]:(0,n.p)(e[1],"YYYY-MM-DD")},t)}})}))}changeQueryParams(t,e=null){this.queryParams=(0,i.$)(this.queryParams,t),e?this.renderTable(e,this.queryParams):this.render(this.queryParams)}actionsTables(t=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((e=>{t(e)}))}async render(t={}){try{this.loader.enable();const e=await this.getData(t);this.tables.length&&e&&this.actionsTables((t=>t.render(e))),this.onRender(e)}catch(t){console.error(t)}finally{this.loader.disable()}}async renderTable(t,e={}){try{this.loader.enable();const a=await this.getData(e);t?.render(a)}catch(t){console.error(t)}finally{this.loader.disable()}}}},1169:(t,e,a)=>{a.d(e,{R:()=>r});var n=a(4929),i=a(291),s=a(5580);function r(t,e="dd.MM.yyyy"){if(!t)throw new Error("Date is required");if("string"==typeof t&&(t=(0,n.H)(t)),!(t instanceof Date)||isNaN(t))throw new Error("Invalid date");return(0,i.GP)(t,e,{locale:s.ru})}}}]);