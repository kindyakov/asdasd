"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[425,829],{8829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(6353),s=a(2302),n=a(3943);const i=class{constructor({loader:e,tables:t=[],charts:a=[],page:r}){this.loader=e,this.wrapper=document.querySelector(`[data-content="dashboards/${r}"]`),this.formFilter=this.wrapper.querySelector(".form-filter-dashboards"),this.tables=[],this.charts=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:a,options:r={},params:s={}}=e;this.table=new t(a,{...r,wrapper:this.wrapper},s),this.tables.push(this.table)})),a.length&&a.forEach((e=>{const{id:t,ChartComponent:a,options:r={}}=e,s=new a(this.wrapper.querySelector(`#${t}`),r);this.charts.push(s)})),this.queryParams={},this.widgets=this.wrapper.querySelectorAll("[data-render-widget]"),this.init(r)}init(e){this.formFilter&&(this.selectFilter=new r.l({uniqueName:"select-filter-main",parentEl:this.wrapper}),this.calendars=(0,s.d)(`[data-content="dashboards/${e}"] .input-date-filter`,{mode:"range",dateFormat:"d. M, Y",onChange:(e,t,a)=>{2===e.length&&this.changeQueryParams({start_date:(0,n.p)(e[0],"YYYY-MM-DD"),end_date:(0,n.p)(e[1],"YYYY-MM-DD")})}})),this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.renderTable(e,{page:t}),e.onChangeTypeUser=({e:t,select:a,optionValue:r})=>this.renderTable(e,{user_type:r}),e.onValueInputSearch=t=>{""!==t?this.renderTable(e,{search_str:t}):this.renderTable(e)}})),this.selectFilter&&(this.selectFilter.onChange=(e,t,a)=>{const r=t.getAttribute("data-name"),s={[r]:a};this.changeQueryParams(s)})}changeQueryParams(e){this.queryParams={...this.queryParams,...e},this.renderDashboard(e)}renderWidgets(e){this.widgets.length&&this.widgets.forEach((t=>{const a=t.getAttribute("data-render-widget"),[r,s]=a.split(","),n=e[r]?e[r]+`${s||""}`:"В процессе доработки";e[r]||(t.style.fontSize="16px"),t.innerHTML=n}))}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}actionsCharts(e=(()=>{})){this.charts.length&&this.charts.forEach((t=>{e(t)}))}async render(){try{this.loader.enable();const[e,t]=await Promise.all([this.getDashboardData(),this.getData()]);e&&(this.renderWidgets(e),this.actionsCharts((t=>t.render(e)))),this.tables.length&&t&&this.actionsTables((e=>e.render(t)))}catch(e){console.error(e)}finally{this.loader.disable()}}async renderDashboard(e){try{this.loader.enable(),await this.getDashboardData(e)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const a=await this.getData(t);e.render(a)}catch(e){console.error(e)}finally{this.loader.disable()}}}},1425:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var r=a(8829),s=a(1014);class n extends r.default{constructor({loader:e}){super({loader:e,page:"marketing"})}async getData(e={}){return[]}async getDashboardData(e={}){return(0,s.tn)(e)}}const i=n}}]);