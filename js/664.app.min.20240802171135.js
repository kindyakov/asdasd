"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[664,212,291],{7846:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(9244);const i=class{constructor(e,t={}){if(!e)throw new Error("Slider element is required.");this.defaultOptions={start:[20,80],range:{min:0,max:100}},this.options={...this.defaultOptions,...t},this.sliderElement=e,this.slider=noUiSlider.create(this.sliderElement,this.options),this.onSliderUpdate=()=>{},this.onSliderSlide=()=>{},this.sliderElement.noUiSlider.on("update",this._onSliderUpdate.bind(this)),this.sliderElement.noUiSlider.on("slide",this._onSliderSlide.bind(this))}_onSliderUpdate(e,t){"function"==typeof this.onSliderUpdate&&this.onSliderUpdate(e,t)}_onSliderSlide(e,t){"function"==typeof this.onSliderSlide&&this.onSliderSlide(e,t)}},a=class{constructor(e,t={},n){e&&(this.defaultOptions={duration:0,allowHTML:!0,content:"<div>Пусто</div>",trigger:"click",placement:"bottom-start",interactive:!0,appendTo:document.body},this.defaultFilterValues=n,this.filterParams={...this.defaultFilterValues},this.options=Object.assign({},this.defaultOptions,t),this.onOpen=()=>{},this.onClose=()=>{},this.onInput=()=>{},this.onApply=()=>{},this.onClear=()=>{},this.instanceTippy=(0,s.Ay)(e,{onTrigger:(e,t)=>this.onOpen(e,t),onShow:()=>{},onHide:e=>this.onClose(e),...this.options}),this.button=e,this.inputs=[],this.btnApply=[],this.btnClear=[],this.rangeFilters=[],this.rangeSlider=[],this.isSync=!1,this.init(e))}init(e){if(e.length){for(let t=0;t<e.length;t++)this.inputs.push(...this.instanceTippy[t].popper.querySelectorAll(".input-filter")),this.btnApply.push(this.instanceTippy[t].popper.querySelector(".btn-filter-apply")),this.btnClear.push(this.instanceTippy[t].popper.querySelector(".btn-filter-clear")),this.rangeFilters.push(...this.instanceTippy[t].popper.querySelectorAll(".range-filter"));this.isSync=!0}else this.inputs=[...this.instanceTippy.popper.querySelectorAll(".input-filter")],this.btnApply=[this.instanceTippy.popper.querySelector(".btn-filter-apply")],this.btnClear=[this.instanceTippy.popper.querySelector(".btn-filter-clear")],this.rangeFilters=[...this.instanceTippy.popper.querySelectorAll(".range-filter")];this.attachEvents()}attachEvents(){this.inputs.length&&this.inputs.forEach((e=>{const[t,n]=e.name.split("_");e.addEventListener("input",(()=>this.handleInput(e,[t,n]))),e.addEventListener("keydown",(s=>this.handleArrowKeys(e,s,[t,n])))})),this.rangeFilters.length&&this.rangeFilters.forEach((e=>{const[t,n]=e.getAttribute("data-name").split(","),s=new i(e,{start:[this.defaultFilterValues[t],this.defaultFilterValues[n]],range:{min:this.defaultFilterValues[t],max:this.defaultFilterValues[n]},step:1});s.onSliderSlide=(e,t)=>this.handleSliderSlide(e,t,s),this.rangeSlider.push(s)})),this.btnApply.length&&this.btnApply.forEach((e=>e.addEventListener("click",(()=>this.handleBtnApply())))),this.btnClear.length&&this.btnClear.forEach((e=>e.addEventListener("click",(()=>this.handleBtnClear()))))}handleInput(e,[t,n]){this.validateAndCorrect(e,[t,n]),this.onInput()}handleArrowKeys(e,t,[n,s]){const i=+e.getAttribute("data-step"),a=i>=1?0:1,l=this.defaultFilterValues[`${n}_end`];let r=parseFloat(e.value)||0;"ArrowUp"===t.key&&r<l?(r+=i,e.value=r.toFixed(a),t.preventDefault()):"ArrowDown"===t.key&&r>0&&(r-=i,e.value=r.toFixed(a),t.preventDefault()),this.validateAndCorrect(e,[n,s])}handleBtnApply(){this.isSync?this.forInstance((e=>e.hide())):this.instanceTippy.hide(),this.onApply(this.filterParams)}handleBtnClear(){this.inputs.length&&this.inputs.forEach((e=>{e.value=this.defaultFilterValues[e.name],this.changeParams(e,e.value)})),this.rangeSlider.length&&this.rangeSlider.forEach((e=>{e.slider.set(e.options.start)})),this.onClear(this.filterParams)}handleSliderSlide(e,t,n){const s=parseInt(e[t]),i=n.sliderElement.getAttribute("data-name").split(","),a=n.sliderElement.parentElement.querySelector(`[name="${i[t]}"]`);a.value=s,this.isSync&&this.syncFilters(a),this.changeParams(a,a.value)}updateSliderSlide(e,t=!1){const n=e.closest(".filter__block").querySelector(".range-filter");if(n&&this.rangeSlider.length){const s=this.rangeSlider.filter((e=>e.sliderElement.dataset.name===n.dataset.name)),[i,a]=e.name.split("_"),l="start"===a?0:1;s.length&&s.forEach((s=>{if(s.sliderElement==n&&t)return;const i=s.slider.get();i[l]=e.value,s.slider.set(i)}))}}fractionalNumber(e,t){let n=e.value;return/^\d+(\.\d)?$/.test(n)||(n=parseFloat(n).toFixed(1),e.value=isNaN(n)?"":n),parseFloat(n)>t&&(n=t,e.value=n),n}validateAndCorrect(e,[t,n]){const s=this.defaultFilterValues[`${t}_end`];let i=this.fractionalNumber(e,s);if("start"===n){const n=Array.from(this.inputs).find((e=>e.name===`${t}_end`));n&&parseFloat(i)>parseFloat(n.value)&&(e.value=n.value)}else if("end"===n){const n=Array.from(this.inputs).find((e=>e.name===`${t}_start`));n&&parseFloat(i)<parseFloat(n.value)&&(e.value=n.value)}this.isSync&&this.syncFilters(e),this.changeParams(e,e.value),this.updateSliderSlide(e)}changeParams(e,t){this.filterParams[e.name]=+t}forInstance(e=(()=>{})){for(let t=0;t<this.button.length;t++)e(this.instanceTippy[t])}syncFilters(e){const t=this.inputs.filter((t=>t!==e&&t.name===e.name));t.length&&t.forEach((t=>{t.value=e.value})),this.updateSliderSlide(e,!0)}}},3664:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var s=n(9291),i=n(3282),a=n(2783),l=n(1212);class r extends i.A{constructor(e,t,n){const s={columnDefs:[{headerName:"Номер ячейки",field:"room_id",width:120,resizable:!1,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-agrid"),t.textContent=`№${e.value||""}`,t}},{headerName:"Заряд",field:"electric_quantity",width:100,flex:1,resizable:!1,cellRenderer:e=>{const t=(0,a.n)("div",[],`\n              <span>${e.value?e.value+"%":""}</span>\n              <img src="./img/icons/${(0,l.getBatteryImage)(e.value)}" alt="иконка">`);return t.style.cssText="display: flex; align-items: center; gap: 10px; color: #212b36; font-weight: 400; font-size: 14px;",t}},{headerName:"",width:120,resizable:!1,sortable:!1,cellRenderer:e=>{const t=(0,a.n)("button",["table-button","transparent"],"<span>Открыть</span>");return t.setAttribute("data-json",JSON.stringify(e.data)),t.setAttribute("data-modal","modal-confirm-open-room"),t}}]};super(e,Object.assign({},s,t),Object.assign({},{},n))}render(e){const{rooms_x_locks:t=[],cnt_pages:n,page:s}=e;this.setPage(s,n),this.gridApi?.setGridOption("rowData",t),this.gridApi?.setGridOption("paginationPageSizeSelector",[5,10,15,20,t.length])}}const o=r;var c=n(7846);class h extends c.A{constructor(e,t={}){super(e,{content:'\n  <div class="filter">\n  <div class="filter__content">\n\n    <div class="filter__block">\n      <span class="filter__block_name">Заряд:</span>\n      <div class="filter__block_content">\n        <div class="filter__wp-input">\n          <span class="pref">от</span>\n          <input type="text" name="electric-quantity_start" value="0" data-step="1" class="filter__input input-filter"\n            inputmode="decimal" autocomplete="off">\n        </div>\n        <div class="filter__wp-input">\n          <span class="pref">до</span>\n          <input type="text" name="electric-quantity_end" value="100" data-step="1" class="filter__input input-filter"\n            inputmode="decimal" autocomplete="off">\n        </div>\n      </div>\n    </div>\n    <div class="filter__block">\n      <div class="filter__list">\n        <label>\n          <input name="" type="checkbox" value="0" class="filter__input input-checkbox" id="filter-input--0">\n          <label for="filter-input--0" class="label-checkbox">\n            <svg class=\'icon icon-check-3\'>\n              <use xlink:href=\'img/svg/sprite.svg#check-3\'></use>\n            </svg>\n          </label>\n          <span>Разряжен</span>\n        </label>\n        <label>\n          <input name="" type="checkbox" value="0" class="filter__input input-checkbox" id="filter-input--1">\n          <label for="filter-input--1" class="label-checkbox">\n            <svg class=\'icon icon-check-3\'>\n              <use xlink:href=\'img/svg/sprite.svg#check-3\'></use>\n            </svg>\n          </label>\n          <span>Сломан</span>\n        </label>\n        <label>\n          <input name="" type="checkbox" value="0" class="filter__input input-checkbox" id="filter-input--2">\n          <label for="filter-input--2" class="label-checkbox">\n            <svg class=\'icon icon-check-3\'>\n              <use xlink:href=\'img/svg/sprite.svg#check-3\'></use>\n            </svg>\n          </label>\n          <span>Норм</span>\n        </label>\n        <label>\n          <input name="" type="checkbox" value="0" class="filter__input input-checkbox" id="filter-input--3">\n          <label for="filter-input--3" class="label-checkbox">\n            <svg class=\'icon icon-check-3\'>\n              <use xlink:href=\'img/svg/sprite.svg#check-3\'></use>\n            </svg>\n          </label>\n          <span>И т.д</span>\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class="filter__footer">\n    <button class="filter__button button btn-filter-apply"><span>Применить</span></button><button\n      class="filter__button button transparent btn-filter-clear"><span>Очистить фильтр</span></button>\n  </div>\n</div>',...t},{electric_quantity_start:0,electric_quantity_end:100})}}const p=h;var d=n(1014),u=n(6353);class f extends s.default{constructor({loader:e}){super({loader:e,tables:[{tableSelector:".table-locks",TableComponent:o,options:{paginationPageSize:15}}],page:"charging-locks"}),this.tableLocks=this.tables[0],this.customSelect=new u.l({uniqueName:"select-change-display"}),this.filterLocks=new p(this.wrapper.querySelector(".btn-set-filters")),this.locksContent=this.wrapper.querySelector(".locks"),this.inputSearch=this.wrapper.querySelector(".input-search"),this.customSelect.onChange=(e,t,n)=>{"tile"===n?(this.locksContent.classList.remove("_none"),this.tableLocks.table.classList.add("_none")):(this.locksContent.classList.add("_none"),this.tableLocks.table.classList.remove("_none"))},this.inputSearch&&this.inputSearch.addEventListener("input",this.handleInputSearch.bind(this))}async getData(e={}){return(0,d.gS)(e)}handleInputSearch(e){const t=e.target;t.value=t.value.replace(/\D/g,""),clearTimeout(this.timerInput),this.timerInput=setTimeout((()=>{this.changeQueryParams({search_str:t.value})}),600)}onRender(e){const{rooms_x_locks:t=[]}=e;t.length?this.locksContent.innerHTML=t.map((e=>(0,l.cardHtml)(e))).join(""):this.locksContent.innerHTML='<div class="not-data"><span>Нет замков для отображения</span></div>'}}const g=f},1212:(e,t,n)=>{function s(e){return e>80?"BatteryFull.png":e>60?"BatteryHigh.png":e>40?"BatteryMedium.png":"BatteryLow.png"}function i(e){return`\n  <div class="locks__card">\n      <div class="locks__card_top">\n        <span>Ячейка: №${e.room_id?e.room_id:""}</span>\n      </div>\n      <div class="locks__card_img">\n        <img src="./img/lock.png" alt="Замок">\n      </div>\n      <div class="locks__card_bottom">\n        <div>\n          <b>${e.electric_quantity?e.electric_quantity+"%":""}</b>\n          <img src="./img/icons/${s(e.electric_quantity)}" alt="иконка">\n        </div>\n        <button class="table-button transparent" data-json="${function(e){return JSON.stringify(e).replace(/\s+/g,"").replace(/"/g,"&quot;")}(e)}" data-modal="modal-confirm-open-room"><span>Открыть</span></button>\n      </div>\n    </div>`}n.r(t),n.d(t,{cardHtml:()=>i,getBatteryImage:()=>s})},9291:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var s=n(3943),i=n(1417);const a=class{constructor({loader:e,tables:t=[],page:n}){this.loader=e,this.wrapper=document.querySelector(`[data-content="${n}"]`),this.tables=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:n,options:s={},params:i={}}=e;this.table=new t(n,{...s,wrapper:this.wrapper},i),this.tables.push(this.table)})),this.queryParams={},this.init(n)}onRender(){}init(e){this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.changeQueryParams({page:t},e),e.onValueInputSearch=t=>{let n={};n=""!==t?{search_str:t}:{},this.changeQueryParams(n,e)},e.selects.onChange=(t,n,s)=>{const i=n.getAttribute("data-name");this.changeQueryParams({[i]:s},e)},e.calendar&&(e.calendar.methods.onChange=(t,n,i)=>{if(2===t.length){const[n,a]=i.element.name.split(",");this.changeQueryParams({[n]:(0,s.p)(t[0],"YYYY-MM-DD"),[a]:(0,s.p)(t[1],"YYYY-MM-DD")},e)}})}))}changeQueryParams(e,t=null){this.queryParams=(0,i.$)(this.queryParams,e),t?this.renderTable(t,this.queryParams):this.render(this.queryParams)}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}async render(e={}){try{this.loader.enable();const t=await this.getData(e);this.tables.length&&t&&this.actionsTables((e=>e.render(t))),this.onRender(t)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const n=await this.getData(t);e?.render(n)}catch(e){console.error(e)}finally{this.loader.disable()}}}}}]);