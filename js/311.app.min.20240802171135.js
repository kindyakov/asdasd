"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[311,291,96],{9291:(t,e,a)=>{a.r(e),a.d(e,{default:()=>s});var n=a(3943),r=a(1417);const s=class{constructor({loader:t,tables:e=[],page:a}){this.loader=t,this.wrapper=document.querySelector(`[data-content="${a}"]`),this.tables=[],e.length&&e.forEach((t=>{const{TableComponent:e,tableSelector:a,options:n={},params:r={}}=t;this.table=new e(a,{...n,wrapper:this.wrapper},r),this.tables.push(this.table)})),this.queryParams={},this.init(a)}onRender(){}init(t){this.events()}events(){this.tables.length&&this.actionsTables((t=>{t.onPageChange=e=>this.changeQueryParams({page:e},t),t.onValueInputSearch=e=>{let a={};a=""!==e?{search_str:e}:{},this.changeQueryParams(a,t)},t.selects.onChange=(e,a,n)=>{const r=a.getAttribute("data-name");this.changeQueryParams({[r]:n},t)},t.calendar&&(t.calendar.methods.onChange=(e,a,r)=>{if(2===e.length){const[a,s]=r.element.name.split(",");this.changeQueryParams({[a]:(0,n.p)(e[0],"YYYY-MM-DD"),[s]:(0,n.p)(e[1],"YYYY-MM-DD")},t)}})}))}changeQueryParams(t,e=null){this.queryParams=(0,r.$)(this.queryParams,t),e?this.renderTable(e,this.queryParams):this.render(this.queryParams)}actionsTables(t=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((e=>{t(e)}))}async render(t={}){try{this.loader.enable();const e=await this.getData(t);this.tables.length&&e&&this.actionsTables((t=>t.render(e))),this.onRender(e)}catch(t){console.error(t)}finally{this.loader.disable()}}async renderTable(t,e={}){try{this.loader.enable();const a=await this.getData(e);t?.render(a)}catch(t){console.error(t)}finally{this.loader.disable()}}}},3311:(t,e,a)=>{a.r(e),a.d(e,{default:()=>v});const n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var r,s=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)}for(var i=[],d=0;d<256;++d)i.push((d+256).toString(16).slice(1));const l=function(t,e,a){if(n.randomUUID&&!e&&!t)return n.randomUUID();var r=(t=t||{}).random||(t.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){a=a||0;for(var s=0;s<16;++s)e[a+s]=r[s];return e}return function(t,e=0){return(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase()}(r)};var h=a(9291),c=a(4096),u=a(3282),p=a(3943),m=a(2783);class g extends u.A{constructor(t,e,a){const n={columnDefs:[{headerName:"ФИО",field:"manager_fullname",minWidth:250,flex:1,resizable:!1},{headerName:"Дата",field:"date",minWidth:80,flex:.5,resizable:!1,valueFormatter:t=>(0,p.p)(t.value)},{headerName:"Время начала рабочего дня",field:"time_start",minWidth:100,flex:.6,resizable:!1},{headerName:"Время окончания рабочего дня",field:"time_end",minWidth:100,flex:.6,resizable:!1},{headerName:"Фотоотчет",field:"",minWidth:100,flex:.5,resizable:!1,sortable:!1,cellRenderer:t=>(0,m.n)("div",["wrap-photo-report"],`\n              <div data-src="${t.data.start_photo_link}" data-fancybox="table-employee" data-caption="Фото начало рабочего дня </br>Время: ${t.data.time_start}</br>Сотрудник: ${t.data.manager_fullname}">\n                <img src="${t.data.start_photo_link}"/>\n              </div>\n              ${t.data.end_photo_link?`\n              <div data-src="${t.data.end_photo_link}" data-fancybox="table-employee" data-caption="Фото завершения рабочего дня </br>Время: ${t.data.time_end}</br>Сотрудник: ${t.data.manager_fullname}">\n                <img src="${t.data.end_photo_link}"/>\n              </div>`:""}`)}]};super(t,Object.assign({},n,e),Object.assign({},{},a))}render(t){const{timepoints:e=[],cnt_pages:a,page:n}=t;this.gridApi.setGridOption("rowData",e),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,e.length])}}const _=g;var b=a(5918),w=a(9706),f=a(2514),y=a(7446);class k extends h.default{constructor({loader:t}){super({loader:t,tables:[{tableSelector:".table-employee",TableComponent:_,options:{paginationPageSize:15}}],page:"working-hours"}),this.timePoints=[],this.timePoint=null,this.init()}init(){this.wrapper&&(this.workingHours=this.wrapper.querySelector(".working-hours"),this.events())}events(){b.A.onOpen=t=>{t&&(this.timePoint=b.A.extractData(t))},b.A.onSave=()=>{if(b.A.file){const t=new FileReader,e=new FormData;let a,n;"start"===this.timePoint.start_or_end?(a="time_start",n="start_photo_link"):(n="end_photo_link",a="time_end"),t.onload=t=>this.timePoint[n]=t.target.result,t.readAsDataURL(b.A.file),e.append("file",b.A.file),e.append("start_or_end",n),this.timePoint[a]=(0,y.O)(":"),this.addTimePoint(e)}else b.A.label.classList.add("_error")}}checkAndInsert(t){const e=(new Date).toISOString().split("T")[0],a=t.find((t=>t.date===e));t.forEach((t=>{t.id=l(),this.workingHours.insertAdjacentHTML("beforeend",(0,c.rowHtml)(t))})),a||this.workingHours.insertAdjacentHTML("beforeend",(0,c.rowHtml)())}onRender(t){const{timepoints:e=[]}=t;this.timePoints=e,this.workingHours.innerHTML="",e.length?this.checkAndInsert(e):this.workingHours.insertAdjacentHTML("beforeend",(0,c.rowHtml)())}changeRow(t){const e=this.workingHours.querySelector(`[data-id="${t.id}"]`);e&&(e.insertAdjacentHTML("afterend",(0,c.rowHtml)(t)),e.remove())}async addTimePoint(t){try{b.A.loader.enable();const e=await w.F.post("/_add_timepoint_",t);if(200!==e.status)return;(0,f.G)(e.data),"success"===e.data.msg_type&&this.changeRow(this.timePoint),b.A.close()}catch(t){console.error(t)}finally{b.A.loader.disable()}}async getData(){try{const t=await w.F.get("/_get_time_control_info_");return 200!==t.status?null:t.data}catch(t){throw console.error(t),t}}}const v=k},4096:(t,e,a)=>{a.r(e),a.d(e,{rowHtml:()=>s});var n=a(3943),r=a(1169);function s(t=!1){function e(t){return JSON.stringify(t).replace(/\s+/g,"").replace(/"/g,"&quot;")}return`\n  <div class="working-hours__row" data-id="${t.id?t.id:""}">\n      <span class="working-hours__date">${t.date?(0,n.p)(t.date):""}</span>\n      <div class="working-hours__item">\n        <b class="working-hours__time time-now">${function(){const t=new Date;return`${t.getHours()<10?"0"+t.getHours():t.getHours()}:${t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}`}()}</b>\n        <span class="working-hours__text date-now">${(0,r.R)(new Date,"dd, MMMM yyyy 'г.'")}</span>\n      </div>\n      <div class="working-hours__item">\n        ${t?.time_start?`\n          <b class="working-hours__time time-start">${t.time_start}</b>\n          <span class="working-hours__text">Вы начали рабочий день</span>`:""}\n      </div>\n      <div class="working-hours__item">\n        ${t?.time_end?`\n          <b class="working-hours__time time-end">${t?.time_end}</b>\n          <span class="working-hours__text">Вы завершили рабочий день</span>`:""}\n      </div>\n      <div class="working-hours__item">\n        ${t?`\n        ${t.time_end?"":`<button class="button btn-end-working-day" data-json="${e({...t,start_or_end:"end"})}" data-modal="modal-download-photo-wh"><span>Завершить рабочий день</span></button>`}\n        ${t.start_photo_link?`<button class="button" data-json="${e({...t,showPhoto:t.start_photo_link})}" data-modal="modal-show-photo-wh"><span>Фото начало</span></button>`:""}\n      ${t.end_photo_link?`<button class="button" data-json="${e({...t,showPhoto:t.end_photo_link})}" data-modal="modal-show-photo-wh"><span>Фото завершения</span></button>`:""}\n                `:`<button class="button btn-start-working-day" data-json="${e({...t,start_or_end:"start"})}" data-modal="modal-download-photo-wh"><span>Начать рабочий день</span></button>`}\n      </div>\n    </div>`}},1169:(t,e,a)=>{a.d(e,{R:()=>o});var n=a(4929),r=a(291),s=a(5580);function o(t,e="dd.MM.yyyy"){if(!t)throw new Error("Date is required");if("string"==typeof t&&(t=(0,n.H)(t)),!(t instanceof Date)||isNaN(t))throw new Error("Invalid date");return(0,r.GP)(t,e,{locale:s.ru})}}}]);