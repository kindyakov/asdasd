"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[833,291,368],{9291:(e,s,n)=>{n.r(s),n.d(s,{default:()=>r});var t=n(3943),a=n(1417);const r=class{constructor({loader:e,tables:s=[],page:n}){this.loader=e,this.wrapper=document.querySelector(`[data-content="${n}"]`),this.tables=[],s.length&&s.forEach((e=>{const{TableComponent:s,tableSelector:n,options:t={},params:a={}}=e;this.table=new s(n,{...t,wrapper:this.wrapper},a),this.tables.push(this.table)})),this.queryParams={},this.init(n)}onRender(){}init(e){this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=s=>this.changeQueryParams({page:s},e),e.onValueInputSearch=s=>{let n={};n=""!==s?{search_str:s}:{},this.changeQueryParams(n,e)},e.selects.onChange=(s,n,t)=>{const a=n.getAttribute("data-name");this.changeQueryParams({[a]:t},e)},e.calendar&&(e.calendar.methods.onChange=(s,n,a)=>{if(2===s.length){const[n,r]=a.element.name.split(",");this.changeQueryParams({[n]:(0,t.p)(s[0],"YYYY-MM-DD"),[r]:(0,t.p)(s[1],"YYYY-MM-DD")},e)}})}))}changeQueryParams(e,s=null){this.queryParams=(0,a.$)(this.queryParams,e),s?this.renderTable(s,this.queryParams):this.render(this.queryParams)}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((s=>{e(s)}))}async render(e={}){try{this.loader.enable();const s=await this.getData(e);this.tables.length&&s&&this.actionsTables((e=>e.render(s))),this.onRender(s)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,s={}){try{this.loader.enable();const n=await this.getData(s);e?.render(n)}catch(e){console.error(e)}finally{this.loader.disable()}}}},7833:(e,s,n)=>{n.r(s),n.d(s,{default:()=>h});var t=n(9244),a=n(9291),r=n(1014),c=n(2783),l=n(368),o=n(9706),i=n(2514);class d extends a.default{constructor({loader:e}){super({loader:e,tables:[],page:"users"}),this.usersEl=this.wrapper.querySelector(".users")}async getData(e={}){return(0,r.$m)(e)}onRender(e){const{managers:s=[]}=e;s.length?(this.usersEl.innerHTML="",this.organizeEmployees(s).forEach((e=>this.usersEl.insertAdjacentElement("beforeend",this.managerRender(e))))):this.usersEl.innerHTML="Нет сотрудников"}organizeEmployees(e){const s=e.reduce(((e,s)=>(e[s.manager_id]=s,s.subordinates=[],e)),{});return e.forEach((e=>{const n=e.chief_id;null!==n&&s[n].subordinates.push(e)})),e.filter((e=>null===e.chief_id))}managerRender(e){const s=(0,c.n)("div",["employee"],(0,l.employeeHtml)(e)),n=s.querySelector(".button-actions");if(e.subordinates.length){const n=s.querySelector(".button-open-subordinates"),t=s.querySelector(".subordinates");n.classList.add("_vis"),e.subordinates.forEach((e=>t.insertAdjacentElement("beforeend",this.managerRender(e)))),n.addEventListener("click",(()=>{n.classList.toggle("_open"),t.classList.toggle("_open")}))}return this.accessesPopupRender(n,e),s}accessesPopupRender(e,s){const n=(0,t.Ay)(e,{duration:0,allowHTML:!0,content:(0,l.accessesPopupHtml)(s),trigger:"click",placement:"bottom-start",interactive:!0,appendTo:document.body,maxWidth:320}).popper.querySelector(".accesses-popup").querySelectorAll("input");let a={manager_id:s.manager_id},r=null;n.length&&n.forEach((e=>{e.addEventListener("change",(()=>{clearTimeout(r),r=setTimeout((()=>{n.forEach((e=>a[e.name]=e.checked?1:0)),this.setAccesses(a)}),1e3)}))}))}async setAccesses(e){try{this.loader.enable();const s=await o.F.post("/_set_accesses_",e);if(200!==s.status)return;(0,i.G)(s.data)}catch(e){throw console.log(e),e}finally{this.loader.disable()}}}const h=d},368:(e,s,n)=>{function t(e){return`<div class="employee__body">\n        <div class="employee__img">\n          <img src="">\n        </div>\n        <div class="employee__content">\n          <h6>${e.manager_fullname?e.manager_fullname:""}</h6>\n          <span>${e.role?e.role:""}</span>\n        </div>\n        <button class="button-actions">\n          <svg viewBox="0 0 16 4" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">\n            <path\n              d="M2 0C0.9 0 0 0.9 0 2C0 3.1 0.9 4 2 4C3.1 4 4 3.1 4 2C4 0.9 3.1 0 2 0ZM14 0C12.9 0 12 0.9 12 2C12 3.1 12.9 4 14 4C15.1 4 16 3.1 16 2C16 0.9 15.1 0 14 0ZM8 0C6.9 0 6 0.9 6 2C6 3.1 6.9 4 8 4C9.1 4 10 3.1 10 2C10 0.9 9.1 0 8 0Z" />\n          </svg>\n        </button>\n      </div>\n      <button class="button-open-subordinates">\n        <svg class='icon icon-plus'>\n          <use xlink:href='img/svg/sprite.svg#plus'></use>\n        </svg>\n        <svg viewBox="0 0 8 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-arrow">\n          <path\n            d="M3.64645 16.3536C3.84171 16.5488 4.15829 16.5488 4.35355 16.3536L7.53553 13.1716C7.7308 12.9763 7.7308 12.6597 7.53553 12.4645C7.34027 12.2692 7.02369 12.2692 6.82843 12.4645L4 15.2929L1.17157 12.4645C0.976311 12.2692 0.659728 12.2692 0.464466 12.4645C0.269204 12.6597 0.269204 12.9763 0.464466 13.1716L3.64645 16.3536ZM3.5 0V2.28571H4.5V0H3.5ZM3.5 5.71429V10.2857H4.5V5.71429H3.5ZM3.5 13.7143V16H4.5V13.7143H3.5Z" />\n        </svg>\n      </button>\n\n      <div class="subordinates">\n        \n      </div>`}function a(e){return`\n  <div class="accesses-popup">\n    <h5 class="accesses-popup__title">Доступы</h5>\n    <div class="accesses-popup__content">\n      <label>\n        <input type="checkbox" name="can_add_clients_agrs" ${e.can_add_clients_agrs?"checked":""}>\n        <p>Можно создавать договоры клиентам</p>\n      </label>\n      <label>\n        <input type="checkbox" name="can_add_edit_payments" ${e.can_add_edit_payments?"checked":""}>\n        <p>Можно редактировать платежи</p>\n      </label>\n      <label>\n        <input type="checkbox" name="can_approve_clients" ${e.can_approve_clients?"checked":""}>\n        <p>Можно подтверждать паспортные данные</p>\n      </label>\n      <label>\n        <input type="checkbox" name="can_edit_clients" ${e.can_edit_clients?"checked":""}>\n        <p>Можно редактировать клиентов</p>\n      </label>\n      <label>\n        <input type="checkbox" name="can_set_accesses" ${e.can_set_accesses?"checked":""}>\n        <p>Можно устанавливать доступы</p>\n      </label>\n    </div>\n  </div>`}n.r(s),n.d(s,{accessesPopupHtml:()=>a,employeeHtml:()=>t})}}]);