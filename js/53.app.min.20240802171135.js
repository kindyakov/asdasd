"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[53,291],{3349:(e,t,a)=>{a.d(t,{A:()=>p});var n=a(3282),s=(a(9706),a(3711)),i=a(6047),r=a(2346),l=a(9661),o=a(3943),c=a(1014);class d extends n.A{constructor(e,t,a){const n={columnDefs:[{headerCheckboxSelection:!0,checkboxSelection:!0,width:50,resizable:!1,sortable:!1},{headerName:"Договор",field:"agrid",minWidth:80,flex:.3,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-agrid"),t.textContent=e.value?(0,r.H)(e.value):"нет",(0,l.a)(e,{el:t})}},{headerName:"ФИО",field:"fullname",minWidth:300,flex:1,cellRenderer:e=>(0,l.a)(e,{iconId:"profile"})},{headerName:"Дата начала",field:"agrbegdate",minWidth:130,flex:.6,cellRenderer:e=>(0,l.a)(e,{funcFormate:o.p,iconId:"calendar"})},{headerName:"Платеж в мес.",field:"price",minWidth:100,flex:.5,cellRenderer:e=>{const t=document.createElement("span");return t.classList.add("table-span-price"),t.innerHTML=e.value?(0,i.F)(e.value):"нет",(0,l.a)(e,{el:t})}},{headerName:"Ячейки",field:"room_ids",minWidth:70,flex:.5,valueFormatter:e=>e.value?(0,r.H)(e.value):"нет"},{headerName:"Конец договора",field:"agrplanenddate",minWidth:100,flex:.5,valueFormatter:e=>e.value?(0,o.p)(e.value):"нет"},{headerName:"Способ оплаты",field:"last_payment_type",minWidth:100,flex:.5},{headerName:"Действия",field:"actions",width:80,cellRenderer:e=>this.actionCellRenderer(e),resizable:!1,sortable:!1}]};super(e,Object.assign({},n,t),Object.assign({},{selectTypeUser:!0,onChangeTypeUser:()=>{}},a)),this.actionCellRenderer=this.actionCellRenderer.bind(this),this.enableEditing=this.enableEditing.bind(this),this.onChangeTypeUser=this.params.onChangeTypeUser}actionCellRenderer(e){const{user_id:t,user_type:a}=e.data,n=(e.eGridCell.closest(".ag-row"),document.createElement("button"));return n.classList.add("button-table-actions"),n.innerHTML="<span></span><span></span><span></span><svg class='icon icon-check'><use xlink:href='img/svg/sprite.svg#check'></use></svg>",(0,s.o)(n,{onOpen:()=>{},attrModal:"modal-agreement",data:e.data}),n}render(e){const{agreements:t,cnt_pages:a,page:n}=e;this.setPage(n,a),this.gridApi.setGridOption("rowData",t),this.gridApi.setGridOption("paginationPageSizeSelector",[5,10,15,20,t.length])}async download(e){try{this.loader.enable();let t={};if(e.length){const a=e.map((e=>e.agrid));t.all_agrs=0,t.agrids=a}else t.all_agrs=1;await(0,c.PC)(t)}catch(e){console.error(e)}finally{this.loader.disable()}}}const p=d},3711:(e,t,a)=>{a.d(t,{o:()=>i});var n=a(9244);let s={tippyInstance:null,isEdit:!1,buttons:[(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-edit-row-table"),t.innerHTML="\n      <svg class='icon icon-edit'>\n        <use xlink:href='img/svg/sprite.svg#edit'></use>\n      </svg>\n      <span>Редактировать</span>",t},(e={})=>{const t=document.createElement("button");return t.classList.add("tippy-button","table-tippy-client__button","btn-open"),t.innerHTML="\n      <svg class='icon icon-arrow-right-circle' styles=\"fill: none;\">\n        <use xlink:href='img/svg/sprite.svg#arrow-right-circle'></use>\n      </svg>\n      <span>Открыть</span>",t}],onEdit:()=>{},onEnableEdit:()=>{},onOpen:()=>{}};function i(e,t={}){const a=Object.assign({toggleEdit:r,toggleActive:l},s,t),i=(0,n.Ay)(e,{allowHTML:!0,trigger:"click",content:t=>{const n=document.createElement("div");function s(t){t.target.closest(".btn-edit-row-table")&&(r(e),a.isEdit=!0,a.onEnableEdit(a)),a.tippyInstance.hide()}return n.classList.add("tippy","table-tippy-client"),a.buttons.forEach((e=>{const t=e();t.setAttribute("data-json",JSON.stringify(a.data)),t.classList.contains("btn-open")&&t.setAttribute("data-modal",a.attrModal),t.addEventListener("click",s),n.appendChild(t)})),n},maxWidth:180,duration:0,placement:"bottom-start",interactive:!0,appendTo:document.body,onTrigger(e,t){a.tippyInstance=e,a.isEdit&&a.onEdit(a)},onShow(t){if(a.isEdit)return!1;l(e)},onHide(t){l(e)}});function r(e){e.classList.toggle("_edit")}function l(e){e.classList.toggle("_active")}return i.options=a,i}},2346:(e,t,a)=>{function n(e){let t,a;return a=Array.isArray(e)?e:e.split(",").map((e=>e.trim())),t=a.map((e=>`№${e}`)),t.join(", ")}a.d(t,{H:()=>n})},9661:(e,t,a)=>{a.d(t,{a:()=>i});var n=a(2783);const s={funcFormate:e=>e,iconId:null,el:null,inputmode:"text",attributes:[]};function i(e,t={}){const{funcFormate:a,iconId:i,el:r,inputmode:l,attributes:o}=Object.assign({},s,t),c=(0,n.n)("div",["wp-input","wp-input-cell","not-edit"]);let d="";if(r&&(c.classList.add("is-dop-content"),r.classList.add("dop-el-content")),i){const e=`<svg class='icon icon-${i}'><use xlink:href='img/svg/sprite.svg#${i}'></use></svg>`;c.insertAdjacentHTML("afterbegin",e),c.classList.add("is-icon")}return o.length&&(d=o.map((e=>`${e[0]}="${e[1]}"`)).join(" ")),c.insertAdjacentHTML("beforeend",`<input type="text" name="${e.colDef.field}" value="${e.value?a(e.value):""}" class="input-cell cell-input not-edit" autocomplete="off" readonly="true" inputmode="${l}" ${d}>${r?r.outerHTML:""}`),c}},5053:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var n=a(9291),s=a(3349),i=a(1014);class r extends n.default{constructor({loader:e}){super({loader:e,tables:[{tableSelector:".table-agreements",TableComponent:s.A,options:{paginationPageSize:15}}],page:"agreements"})}async getData(e={}){return(0,i.Y4)(e)}}const l=r},9291:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(3943),s=a(1417);const i=class{constructor({loader:e,tables:t=[],page:a}){this.loader=e,this.wrapper=document.querySelector(`[data-content="${a}"]`),this.tables=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:a,options:n={},params:s={}}=e;this.table=new t(a,{...n,wrapper:this.wrapper},s),this.tables.push(this.table)})),this.queryParams={},this.init(a)}onRender(){}init(e){this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.changeQueryParams({page:t},e),e.onValueInputSearch=t=>{let a={};a=""!==t?{search_str:t}:{},this.changeQueryParams(a,e)},e.selects.onChange=(t,a,n)=>{const s=a.getAttribute("data-name");this.changeQueryParams({[s]:n},e)},e.calendar&&(e.calendar.methods.onChange=(t,a,s)=>{if(2===t.length){const[a,i]=s.element.name.split(",");this.changeQueryParams({[a]:(0,n.p)(t[0],"YYYY-MM-DD"),[i]:(0,n.p)(t[1],"YYYY-MM-DD")},e)}})}))}changeQueryParams(e,t=null){this.queryParams=(0,s.$)(this.queryParams,e),t?this.renderTable(t,this.queryParams):this.render(this.queryParams)}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}async render(e={}){try{this.loader.enable();const t=await this.getData(e);this.tables.length&&t&&this.actionsTables((e=>e.render(t))),this.onRender(t)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const a=await this.getData(t);e?.render(a)}catch(e){console.error(e)}finally{this.loader.disable()}}}}}]);