"use strict";(self.webpackChunkgulp2023=self.webpackChunkgulp2023||[]).push([[829],{8829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var s=a(6353),r=a(2302),i=a(3943);const h=class{constructor({loader:e,tables:t=[],charts:a=[],page:s}){this.loader=e,this.wrapper=document.querySelector(`[data-content="dashboards/${s}"]`),this.formFilter=this.wrapper.querySelector(".form-filter-dashboards"),this.tables=[],this.charts=[],t.length&&t.forEach((e=>{const{TableComponent:t,tableSelector:a,options:s={},params:r={}}=e;this.table=new t(a,{...s,wrapper:this.wrapper},r),this.tables.push(this.table)})),a.length&&a.forEach((e=>{const{id:t,ChartComponent:a,options:s={}}=e,r=new a(this.wrapper.querySelector(`#${t}`),s);this.charts.push(r)})),this.queryParams={},this.widgets=this.wrapper.querySelectorAll("[data-render-widget]"),this.init(s)}init(e){this.formFilter&&(this.selectFilter=new s.l({uniqueName:"select-filter-main",parentEl:this.wrapper}),this.calendars=(0,r.d)(`[data-content="dashboards/${e}"] .input-date-filter`,{mode:"range",dateFormat:"d. M, Y",onChange:(e,t,a)=>{2===e.length&&this.changeQueryParams({start_date:(0,i.p)(e[0],"YYYY-MM-DD"),end_date:(0,i.p)(e[1],"YYYY-MM-DD")})}})),this.events()}events(){this.tables.length&&this.actionsTables((e=>{e.onPageChange=t=>this.renderTable(e,{page:t}),e.onChangeTypeUser=({e:t,select:a,optionValue:s})=>this.renderTable(e,{user_type:s}),e.onValueInputSearch=t=>{""!==t?this.renderTable(e,{search_str:t}):this.renderTable(e)}})),this.selectFilter&&(this.selectFilter.onChange=(e,t,a)=>{const s=t.getAttribute("data-name"),r={[s]:a};this.changeQueryParams(r)})}changeQueryParams(e){this.queryParams={...this.queryParams,...e},this.renderDashboard(e)}renderWidgets(e){this.widgets.length&&this.widgets.forEach((t=>{const a=t.getAttribute("data-render-widget"),[s,r]=a.split(","),i=e[s]?e[s]+`${r||""}`:"В процессе доработки";e[s]||(t.style.fontSize="16px"),t.innerHTML=i}))}actionsTables(e=(()=>{})){if(!this.tables.length)return console.error("Нет таблиц");this.tables.forEach((t=>{e(t)}))}actionsCharts(e=(()=>{})){this.charts.length&&this.charts.forEach((t=>{e(t)}))}async render(){try{this.loader.enable();const[e,t]=await Promise.all([this.getDashboardData(),this.getData()]);e&&(this.renderWidgets(e),this.actionsCharts((t=>t.render(e)))),this.tables.length&&t&&this.actionsTables((e=>e.render(t)))}catch(e){console.error(e)}finally{this.loader.disable()}}async renderDashboard(e){try{this.loader.enable(),await this.getDashboardData(e)}catch(e){console.error(e)}finally{this.loader.disable()}}async renderTable(e,t={}){try{this.loader.enable();const a=await this.getData(t);e.render(a)}catch(e){console.error(e)}finally{this.loader.disable()}}}}}]);